<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>SISTEMA NEONATAL INTEGRAL v21.0 - HSVP</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #27ae60;
            --bg: #f4f7f6;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg);
            padding: 10px;
            font-size: 11px;
            color: #333;
        }

        .container {
            max-width: 1450px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-top: 10px solid var(--primary);
        }

        h1 {
            text-align: center;
            color: var(--primary);
            border-bottom: 4px solid var(--secondary);
            padding-bottom: 10px;
        }

        h2 {
            background: var(--primary);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 25px;
            font-size: 1.2em;
            border-left: 10px solid var(--secondary);
            text-transform: uppercase;
        }

        h3 {
            color: var(--secondary);
            border-bottom: 2px solid #eee;
            margin-top: 20px;
            font-size: 1.1em;
            padding-bottom: 5px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .field {
            display: flex;
            flex-direction: column;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        input,
        select,
        textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 11px;
            background: #fff;
        }

        .calc-card {
            background: #eef2f7;
            border: 2px solid #d1d8e0;
            padding: 15px;
            border-radius: 10px;
        }

        .hijo-row {
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 5px;
            border-radius: 5px;
            display: grid;
            grid-template-columns: 0.5fr 1fr 1fr 1fr 2fr;
            gap: 10px;
        }

        .inmu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #fff;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #eee;
        }

        .highlight-box {
            border: 2px solid var(--secondary) !important;
            background: #f0f7ff !important;
            font-weight: bold;
            text-align: center;
        }

        .score-box {
            background: #fff;
            padding: 8px;
            border: 1px dotted #999;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .ef-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 10px;
            align-items: center;
            background: #fff;
            padding: 6px;
            border-bottom: 1px solid #eee;
        }

        /* Estilos ADCAVANDIMELCO */
        .adcav-grid {
            display: grid;
            grid-template-columns: 70px 1fr;
            gap: 15px;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .letra {
            color: #3498db;
            font-size: 2.2em;
            font-weight: bold;
            text-align: center;
            font-family: 'Georgia', serif;
        }

        .input-inline {
            width: 100%;
            border: 1px solid #ddd;
            padding: 6px;
            border-radius: 4px;
            font-size: 11px;
        }

        /* Estilos CIE-10 */
        .dx-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
        }

        .dx-table th,
        .dx-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .search-container {
            position: relative;
            width: 100%;
        }

        #dx-search {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            font-weight: bold;
        }

        .suggestions {
            position: absolute;
            width: 100%;
            background: white;
            border: 1px solid #ddd;
            z-index: 100;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .suggestion-item:hover {
            background: #e3f2fd;
        }

        .btn-main {
            background: var(--accent);
            color: white;
            padding: 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 30px;
            font-size: 1.2em;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>SISTEMA NEONATAL INTEGRAL - HSVP</h1>

        <h2>1. Datos de Filiación y Admisión</h2>
        <div class="calc-card" style="margin-bottom: 20px; border: 2px solid var(--secondary);">
            <div class="grid">
                <div class="field"><label><b>FECHA DE INGRESO:</b></label><input type="date" id="fIngreso"
                        onchange="calcEdadAlIngreso()"></div>
                <div class="field"><label><b>FECHA DE NACIMIENTO:</b></label><input type="date" id="fNac"
                        onchange="calcEdadAlIngreso()"></div>
                <div class="field"><label>Hora Nacimiento:</label><input type="time" id="hNac"
                        onchange="calcEdadAlIngreso()"></div>
                <div class="field"><label><b>EDAD AL INGRESO:</b></label><input type="text" id="edadReal" readonly
                        class="highlight-box"></div>
            </div>
        </div>

        <div class="grid">
            <div class="field"><label>Primer Apellido:</label><input type="text" id="ape1N"></div>
            <div class="field"><label>Segundo Apellido:</label><input type="text" id="ape2N"></div>
            <div class="field"><label>Nombres:</label><input type="text" id="nomN"></div>
            <div class="field"><label>HCU:</label><input type="text" id="hcu"></div>
            <div class="field"><label>Sexo:</label><select id="sexoN">
                    <option>MASCULINO</option>
                    <option>FEMENINO</option>
                    <option>INDETERMINADO</option>
                </select></div>
        </div>

        <h3>Datos de la Madre</h3>
        <div class="grid">
            <div class="field"><label>Nombre:</label><input type="text" id="nomM"></div>
            <div class="field"><label>Cédula:</label><input type="text" id="cedM"></div>
            <div class="field"><label>Edad:</label><input type="number" id="edadM"></div>
            <div class="field"><label>Instrucción:</label><input type="text" id="insM"></div>
            <div class="field"><label>Ocupación/Profesión:</label><input type="text" id="ocuM"></div>
        </div>
        <div class="grid">
            <div class="field"><label>Raza:</label>
                <select id="razaM">
                    <option value="MESTIZO">MESTIZO</option>
                    <option value="INDIGENA">INDIGENA</option>
                    <option value="AFRODESCENDIENTE">AFRODESCENDIENTE</option>
                    <option value="BLANCO">BLANCO</option>
                </select>
            </div>
            <div class="field"><label>Religión:</label>
                <select id="relM" onchange="toggleOtroReligion(this)">
                    <option value="CATOLICA">CATÓLICA</option>
                    <option value="CRISTIANA">CRISTIANA</option>
                    <option value="EVANGELICA">EVANGÉLICA</option>
                    <option value="TESTIGO DE JEHOVA">TESTIGO DE JEHOVÁ</option>
                    <option value="OTRO">OTRO</option>
                </select>
                <input type="text" id="relM_otro" class="hidden" placeholder="¿Cuál?" style="margin-top:5px">
            </div>
            <div class="field"><label>Tipo de Sangre:</label><select id="gsM">
                    <option value="ORH+">ORH+</option>
                    <option value="ORH-">ORH-</option>
                    <option value="ARH+">ARH+</option>
                    <option value="ARH-">ARH-</option>
                    <option value="BRH+">BRH+</option>
                    <option value="BRH-">BRH-</option>
                    <option value="ABRH+">ABRH+</option>
                    <option value="ABRH-">ABRH-</option>
                </select></div>
            <div class="field"><label>Lugar de Nacimiento:</label><input type="text" id="lugNacM"></div>
        </div>
        <div class="grid">
            <div class="field"><label>Dirección:</label><input type="text" id="dirM"></div>
            <div class="field"><label>Teléfono:</label><input type="text" id="telM"></div>
            <div class="field"><label>Cobertura:</label><select id="cobM">
                    <option>NINGUNA</option>
                    <option>IESS</option>
                    <option>MSP</option>
                    <option>ISSFA</option>
                    <option>ISSPOL</option>
                    <option>PRIVADO</option>
                </select></div>
            <div class="field"><label>Avisar a (Emergencia):</label><textarea id="emergenciaCont" rows="1"></textarea>
            </div>
        </div>

        <h3>Datos del Padre</h3>
        <div class="grid">
            <div class="field"><label>Nombre:</label><input type="text" id="nomP"></div>
            <div class="field"><label>Cédula:</label><input type="text" id="cedP"></div>
            <div class="field"><label>Edad:</label><input type="number" id="edadP"></div>
            <div class="field"><label>Dirección:</label><input type="text" id="dirP"></div>
            <div class="field"><label>Teléfono:</label><input type="text" id="telP"></div>
            <div class="field"><label>Cobertura:</label><select id="cobP">
                    <option>NINGUNA</option>
                    <option>IESS</option>
                    <option>MSP</option>
                    <option>ISSFA</option>
                    <option>ISSPOL</option>
                    <option>PRIVADO</option>
                </select></div>
        </div>

        <h2>2. Antecedentes Clínicos</h2>
        <h3>Patológicos y Familiares</h3>
        <div class="grid">
            <div class="field full-width"><label>Antecedentes Patológicos Maternos:</label><textarea id="antPatM"
                    rows="2"></textarea></div>
            <div class="field full-width"><label>Antecedentes Quirúrgicos Maternos:</label><textarea id="antQuiM"
                    rows="2"></textarea></div>
            <div class="field full-width"><label>Antecedentes Familiares Maternos:</label><textarea id="antFamM"
                    rows="2"></textarea></div>
        </div>

        <h3>Gineco-Obstétricos</h3>
        <div class="grid">
            <div class="field"><label>Menarquia:</label><input type="number" id="menarquia"></div>
            <div class="field"><label>Ciclos:</label><input type="text" id="ciclos"></div>
            <div class="field"><label>IVSA:</label><input type="number" id="ivsa"></div>
            <div class="field"><label>Parejas:</label><input type="number" id="parejas"></div>
            <div class="field"><label>ETS:</label><input type="text" id="ets"></div>
            <div class="field"><label>Paptest:</label><input type="text" id="paptest"></div>
            <div class="field"><label>Método ACO:</label><input type="text" id="aco"></div>
        </div>

        <div class="calc-card">
            <div class="grid">
                <div class="field"><label><b>FUM:</b></label><input type="date" id="fum" onchange="calcEG_FUM()"></div>
                <div class="field"><label><b>EG por FUM:</b></label><input type="text" id="egFum" readonly
                        class="highlight-box"></div>
                <div class="field"><label>EG Eco/Estimada:</label><input type="text" id="egEco"></div>
            </div>
            <div class="grid" style="margin-top:10px">
                <div class="grid" style="margin-top:10px">
                    <div class="field"><label>Gestas:</label><input type="number" id="gestas"
                            oninput="generarGestaciones()"></div>
                    <div class="field"><label>Partos:</label><input type="number" id="partos"></div>
                    <div class="field"><label>Cesáreas:</label><input type="number" id="cesareas"></div>
                    <div class="field"><label>Abortos:</label><input type="number" id="abortos"></div>
                    <div class="field"><label>Hijos Vivos:</label><input type="number" id="hVivos"></div>
                    <div class="field"><label>Hijos Muertos:</label><input type="number" id="hMuertos"
                            oninput="toggleHMuertos()"></div>
                </div>
            </div>
            <div id="contenedorGestaciones"></div>
            <div id="contenedorHijos"></div>
            <div id="detallesMuertos" class="hidden"><label>Descripción Causa de Muerte:</label><textarea
                    id="antHMuertos" class="full-width" rows="2"></textarea></div>

            <h3>Inmunizaciones y Maduración</h3>
            <div class="grid">
                <div class="inmu-item"><input type="checkbox" id="v_dt"> <label>DT</label></div>
                <div class="inmu-item"><input type="checkbox" id="v_hepb"> <label>Hep B</label></div>
                <div class="inmu-item"><input type="checkbox" id="v_inf"> <label>Influenza</label></div>
                <div class="inmu-item"><input type="checkbox" id="v_covid"> <label>COVID-19</label></div>
                <div class="field"><label>Maduración Pulmonar:</label><select id="madPul">
                        <option>NO</option>
                        <option>COMPLETA</option>
                        <option>INCOMPLETA</option>
                    </select></div>
            </div>

            <h3>Antecedentes Narrativos</h3>
            <div class="field full-width"><label><b>ANTECEDENTES PRENATALES:</b></label><textarea id="narrPre"
                    rows="2"></textarea></div>
            <div class="field full-width"><label><b>ANTECEDENTES NATALES:</b></label><textarea id="narrNat"
                    rows="2"></textarea></div>
            <div class="field full-width"><label><b>ANTECEDENTES POSTNATALES:</b></label><textarea id="narrPost"
                    rows="2"></textarea></div>

            <h2>3. Examen Físico y Escalas de Valoración</h2>
            <div class="grid">
                <div class="field"><label>Peso (g):</label><input type="number" id="peso_ex"
                        oninput="document.getElementById('p').value=this.value; recalcular();"></div>
                <div class="field"><label>Talla (cm):</label><input type="number" id="talla"></div>
                <div class="field"><label>P. Cefálico (cm):</label><input type="number" id="pc"></div>
                <div class="field"><label>P. Braquial (cm):</label><input type="number" id="pb"></div>
                <div class="field"><label>FC (lpm):</label><input type="number" id="fc"></div>
                <div class="field"><label>FR (rpm):</label><input type="number" id="fr"></div>
                <div class="field"><label>T° (°C):</label><input type="number" id="temp" step="0.1"></div>
                <div class="field"><label>SatO2 (%):</label><input type="number" id="sat"></div>
                <div class="field">
                    <label>Presión Arterial:</label>
                    <input type="text" id="pa_val" placeholder="ej. 60/40">
                    <a href="https://www.pediatriaintegral.es/numeros-anteriores/publicacion-2015-05/tension-arterial-en-la-infancia/"
                        target="_blank"
                        style="font-size:10px; color:var(--secondary); text-decoration:none; margin-top:3px;">Percentiles
                        PA ↗</a>
                </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr;">
                <div class="calc-card">
                    <h3>Puntuación APGAR</h3>
                    <div class="score-box">FC: <select class="apgar-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Esfuerzo: <select class="apgar-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Tono: <select class="apgar-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Reflejos: <select class="apgar-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Color: <select class="apgar-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="field" style="margin-top:10px;">
                        <label>APGAR 1 min:</label><input type="text" id="resApgar1" readonly class="highlight-box">
                    </div>
                    <div class="field" style="margin-top:5px;">
                        <label>APGAR 5 min:</label><input type="text" id="resApgar5" class="highlight-box">
                    </div>
                    <div class="field" style="margin-top:5px;">
                        <label>APGAR 10 min:</label><input type="text" id="resApgar10" class="highlight-box">
                    </div>
                </div>

                <div class="calc-card">
                    <h3>Score de Downes</h3>
                    <div class="score-box">FR: <select class="downes-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Cianosis: <select class="downes-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Aire: <select class="downes-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Quejido: <select class="downes-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="score-box">Tirajes: <select class="downes-calc">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select></div>
                    <div class="field"><label>TOTAL DOWNES:</label><input type="text" id="resDownes" readonly
                            class="highlight-box"></div>
                </div>
            </div>

            <div class="calc-card" style="margin-top:15px">
                <h3>Examen Físico Regional Detallado</h3>
                <div class="ef-row"><b>Piel y Faneras:</b><textarea id="ef_piel" rows="1">Rosada, elástica.</textarea>
                </div>
                <div class="ef-row"><b>Cabeza:</b><textarea id="ef_cab"
                        rows="1">Normocéfalo, fontanelas normales.</textarea></div>
                <div class="ef-row"><b>Cuello:</b><textarea id="ef_cuello" rows="1">Simétrico, móvil.</textarea></div>
                <div class="ef-row"><b>Tórax:</b><textarea id="ef_torax" rows="1">Simétrico.</textarea></div>
                <div class="ef-row"><b>Pulmones:</b><textarea id="ef_pulm"
                        rows="1">Murmullo vesicular conservado.</textarea></div>
                <div class="ef-row"><b>Corazón:</b><textarea id="ef_cor" rows="1">Rítmico.</textarea></div>
                <div class="ef-row"><b>Abdomen:</b><textarea id="ef_abd"
                        rows="1">Suave, cordón umbilical normal.</textarea></div>
                <div class="ef-row"><b>Genitales:</b><textarea id="ef_genit" rows="1">Acorde a sexo.</textarea></div>
                <div class="ef-row"><b>Extremidades:</b><textarea id="ef_ext" rows="1">Simétricas.</textarea></div>
                <div class="ef-row"><b>Neurológico:</b><textarea id="ef_neuro" rows="1">Activo, reactivo.</textarea>
                </div>
            </div>

            <h2>4. Diagnósticos CIE-10</h2>
            <div class="calc-card">
                <div class="search-container">
                    <input type="text" id="dx-search" placeholder="Escriba para buscar diagnóstico..."
                        oninput="showSuggestions(this.value)">
                    <div id="dx-suggestions" class="suggestions hidden"></div>
                </div>
                <table class="dx-table">
                    <thead>
                        <tr>
                            <th>Cod. CIE-10</th>
                            <th>Diagnóstico</th>
                            <th>Tipo</th>
                            <th>Condición</th>
                            <th>Principal</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody id="lista-dx"></tbody>
                </table>
            </div>

            <h2>5. Plan de Manejo (ADCAVANDIMELCO)</h2>
            <div class="calc-card" style="margin-bottom: 20px; border: 1px solid #d1d8e0;">
                <div class="grid" style="grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <div><label><b>Peso (g):</b></label><input type="number" id="p" value="3000" oninput="recalcular()">
                    </div>
                    <div><label><b>LT (ml/kg/d):</b></label><input type="number" id="l" value="80"
                            oninput="recalcular()"></div>
                    <div><label><b>% Dextrosa:</b></label><input type="number" id="dexPerc" value="10"
                            oninput="recalcular()"></div>
                    <div style="background: #dff9fb; padding: 10px; border-radius: 5px; border: 1px solid #81ecec;">
                        <label><input type="checkbox" id="foto" onchange="recalcular()"> Fototerapia (+15%)</label><br>
                        <label><input type="checkbox" id="cuna" onchange="recalcular()"> Cuna Radiante (+15%)</label>
                    </div>
                </div>
            </div>

            <div id="adcav-form"
                style="background: white; border-radius: 12px; border: 1px solid #eee; overflow: hidden;">
                <div class="adcav-grid">
                    <div class="letra">A</div>
                    <div><b>ADMISION:</b><input class="input-inline" id="adm" value="Neonatología"></div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">D</div>
                    <div><b>DIAGNOSTICOS:</b><textarea class="input-inline" id="diag" rows="2"
                            placeholder="Se sincroniza con CIE-10..."></textarea></div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">C</div>
                    <div><b>CONDICION:</b><select id="cond" class="input-inline">
                            <option>ESTABLE</option>
                            <option>ESTABLE DENTRO DE SU GRAVEDAD</option>
                            <option>CRÍTICO</option>
                            <option>INESTABLE</option>
                        </select></div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">A</div>
                    <div><b>ALERGIAS:</b><select id="aler" class="input-inline">
                            <option>NEGATIVO</option>
                            <option>NO REFIERE</option>
                            <option>PENICILINA</option>
                            <option>OTRO</option>
                        </select></div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">V</div>
                    <div><b>VITALES:</b><input id="vit_txt" class="input-inline"
                            value="CSV cada 3 horas, Monitoreo continuo de SatO2."></div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">A</div>
                    <div><b>ACTITUD:</b><select id="act" class="input-inline">
                            <option>SEMIFOWLER</option>
                            <option>POSICION ANTIRREFLUJO</option>
                            <option>PRONO</option>
                            <option>DECÚBITO LATERAL</option>
                        </select></div>
                </div>

                <div class="adcav-grid">
                    <div class="letra">D</div>
                    <div>
                        <b>DIETA:</b>
                        <select id="tipoDieta" onchange="recalcular()" class="input-inline">
                            <option value="NPO">NADA POR VIA ORAL (NPO)</option>
                            <option value="LM">LECHE MATERNA (LM)</option>
                            <option value="LF">LECHE DE FÓRMULA (LF)</option>
                            <option value="MIXTA">MIXTA (LM + LF)</option>
                        </select>
                        <div id="boxDieta" class="hidden"
                            style="margin-top:5px; background:#f1f2f6; padding:8px; border-radius:5px;">
                            ml/toma: <input type="number" id="dietCant" value="0" style="width:50px"
                                oninput="recalcular()">
                            Frec(h): <select id="dietFreq" onchange="recalcular()" style="width:60px">
                                <option value="3">c/3h</option>
                                <option value="2">c/2h</option>
                                <option value="4">c/4h</option>
                            </select>
                            <span id="resDietaTotal" style="margin-left:15px; font-weight:bold; color:#27ae60;"></span>
                        </div>
                    </div>
                </div>

                <div class="adcav-grid">
                    <div class="letra">I</div>
                    <div>
                        <b>LIQUIDOS INTRAVENOSOS:</b>
                        <div id="resFinalIV"
                            style="background:#fffde7; border:2px solid #ffd54f; padding:15px; border-radius:8px; font-weight:bold; color:#d35400;">
                            Calculando hidratación...
                        </div>
                    </div>
                </div>

                <div class="adcav-grid">
                    <div class="letra">M</div>
                    <div>
                        <b>MEDICAMENTOS:</b>
                        <table style="width:100%; border-collapse: collapse; font-size:10px;">
                            <thead style="background:#2c3e50; color:white;">
                                <tr>
                                    <th>Fármaco</th>
                                    <th>Dosis</th>
                                    <th>Frec</th>
                                    <th>Conc</th>
                                    <th>¿Bal?</th>
                                    <th>Vol/d</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="bodyMed"></tbody>
                        </table>
                        <button onclick="agregarFilaMed()" style="margin-top:10px;">+ Añadir Fármaco</button>
                    </div>
                </div>

                <div class="adcav-grid">
                    <div class="letra">E</div>
                    <div><b>EXAMENES:</b><input class="input-inline" id="exa"
                            placeholder="Ej: Rx Tórax, Eco Transfontanelar"></div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">L</div>
                    <div><b>LABORATORIO:</b><input class="input-inline" id="lab" placeholder="Ej: BHC, PCR, Gasometría">
                    </div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">C</div>
                    <div><b>INTERCONSULTAS:</b><input class="input-inline" id="int"
                            placeholder="Ej: Cardiología, Genética"></div>
                </div>
                <div class="adcav-grid">
                    <div class="letra">O</div>
                    <div><b>OTROS:</b><input class="input-inline" id="otr"
                            value="Cuidados de enfermería, Aseo del cordón."></div>
                </div>
            </div>

            <button class="btn-main" onclick="generarTodo()">GENERAR HISTORIA CLÍNICA E INDICACIONES</button>

            <div id="export-section" class="hidden"
                style="margin-top:20px; border:3px solid #000; padding:25px; background: #fff; border-radius:10px;">
                <div id="finalOutput"
                    style="white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 12px;"></div>
            </div>
        </div>

        <script>
            // --- DB MEDICAMENTOS ---
            const dbHSVP = {
                "AMIKACINA": { d: 15, c: 5, f: 24, b: true },
                "AMPICILINA": { d: 50, c: 100, f: 12, b: true },
                "CEFTAZIDIMA": { d: 50, c: 40, f: 12, b: true },
                "GENTAMICINA": { d: 4, c: 4, f: 24, b: true },
                "GLUCONATO CALCIO 10%": { d: 200, c: 50, f: 24, b: true },
                "MEROPENEM": { d: 40, c: 25, f: 8, b: true },
                "VANCOMICINA": { d: 15, c: 5, f: 12, b: true }
            };

            let listaMedicamentos = [];

            // --- LÓGICA FILIACIÓN Y EDAD ---
            function calcEdadAlIngreso() {
                const naci = document.getElementById('fNac').value;
                const ingr = document.getElementById('fIngreso').value;
                if (naci && ingr) {
                    const d1 = new Date(naci + 'T' + (document.getElementById('hNac').value || "00:00"));
                    const d2 = new Date(ingr + 'T23:59:59');
                    const hrs = Math.floor((d2 - d1) / 3600000);
                    document.getElementById('edadReal').value = hrs < 48 ? hrs + " HORAS" : Math.floor(hrs / 24) + " DÍAS";
                }
            }

            function calcEG_FUM() {
                const f = document.getElementById('fum').value;
                if (f) {
                    const sem = (new Date() - new Date(f)) / (1000 * 60 * 60 * 24 * 7);
                    document.getElementById('egFum').value = Math.floor(sem) + "." + Math.floor((sem % 1) * 7) + " SEMANAS";
                }
            }

            // --- LÓGICA GINECO Y PERINATAL ---
            function generarGestaciones() {
                const num = parseInt(document.getElementById('gestas').value) || 0;
                const cont = document.getElementById('contenedorGestaciones');
                cont.innerHTML = '';
                if (num > 0) {
                    for (let i = 1; i <= num; i++) {
                        cont.innerHTML += `
                    <div class="calc-card" style="margin-top: 10px; border: 1px solid #ccc;">
                        <h4>Gestación ${i}</h4>
                        <div class="grid">
                            <div class="field"><label>Edad Gestacional:</label><input type="text" id="gesta_${i}_edad"></div>
                            <div class="field"><label>Tipo de Parto:</label><select id="gesta_${i}_tipo"><option>PARTO NORMAL</option><option>CESÁREA</option><option>ABORTO</option></select></div>
                            <div class="field full-width"><label>Complicaciones:</label><textarea id="gesta_${i}_comp" rows="1"></textarea></div>
                        </div>
                    </div>
                `;
                    }
                }
            }

            function toggleHMuertos() {
                const muertos = parseInt(document.getElementById('hMuertos').value) || 0;
                const divM = document.getElementById('detallesMuertos');
                if (muertos > 0) divM.classList.remove('hidden');
                else divM.classList.add('hidden');
            }

            // --- LÓGICA ESCALAS ---
            function actualizarEscalas() {
                let a = 0; document.querySelectorAll('.apgar-calc').forEach(s => a += parseInt(s.value));
                document.getElementById('resApgar1').value = a + "/10";
                let d = 0; document.querySelectorAll('.downes-calc').forEach(s => d += parseInt(s.value));
                document.getElementById('resDownes').value = d + "/10";
            }
            document.querySelectorAll('.apgar-calc, .downes-calc').forEach(s => s.onchange = actualizarEscalas);

            // --- LÓGICA CIE-10 ---
            let dbCIE10 = [{ c: "Z38.0", d: "RN VIVO ÚNICO" }, { c: "P36.9", d: "SEPSIS NEONATAL" }, { c: "P22.0", d: "SDR NEONATAL" }, { c: "P59.9", d: "ICTERICIA NEONATAL" }];
            let dxSeleccionados = [];

            function showSuggestions(val) {
                const div = document.getElementById('dx-suggestions');
                if (val.length < 2) { div.classList.add('hidden'); return; }
                const filtered = dbCIE10.filter(i => i.d.includes(val.toUpperCase()) || i.c.includes(val.toUpperCase()));
                div.innerHTML = '';
                filtered.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'suggestion-item';
                    row.innerHTML = `<b>${item.c}</b> - ${item.d}`;
                    row.onclick = () => { dxSeleccionados.push({ id: Date.now(), ...item }); renderDx(); div.classList.add('hidden'); };
                    div.appendChild(row);
                });
                div.classList.remove('hidden');
            }

            function renderDx() {
                const tbody = document.getElementById('lista-dx');
                tbody.innerHTML = '';
                let dxStr = "";
                dxSeleccionados.forEach(item => {
                    tbody.innerHTML += `<tr><td>${item.c}</td><td>${item.d}</td><td><select><option>DEF</option><option>PRE</option></select></td><td><select><option>ING</option></select></td><td><input type="radio" name="p"></td><td><button onclick="dxSeleccionados=dxSeleccionados.filter(x=>x.id!==${item.id});renderDx()">✖</button></td></tr>`;
                    dxStr += item.d + "; ";
                });
                document.getElementById('diag').value = dxStr;
            }

            // --- LÓGICA ADCAVANDIMELCO ---
            function recalcular() {
                const pesoKg = parseFloat(document.getElementById('p').value) / 1000;
                let lt = parseFloat(document.getElementById('l').value) || 0;
                const dex = parseFloat(document.getElementById('dexPerc').value) || 0;

                if (document.getElementById('foto').checked) lt += parseFloat(document.getElementById('l').value) * 0.15;
                if (document.getElementById('cuna').checked) lt += parseFloat(document.getElementById('l').value) * 0.15;

                const volTotal = lt * pesoKg;
                let vDiet = 0;
                if (document.getElementById('tipoDieta').value !== "NPO") {
                    document.getElementById('boxDieta').classList.remove('hidden');
                    vDiet = (parseFloat(document.getElementById('dietCant').value) || 0) * (24 / (parseFloat(document.getElementById('dietFreq').value) || 1));
                    document.getElementById('resDietaTotal').innerText = `(-${vDiet.toFixed(1)} ml/día)`;
                } else { document.getElementById('boxDieta').classList.add('hidden'); }

                let vMedTotal = 0;
                listaMedicamentos.forEach((m, i) => {
                    const vDia = ((pesoKg * m.d) / m.c) * (24 / m.f);
                    if (document.getElementById(`vol_${i}`)) document.getElementById(`vol_${i}`).innerText = vDia.toFixed(2);
                    if (m.b) vMedTotal += vDia;
                });

                const volIV = Math.max(0, volTotal - vDiet - vMedTotal);
                const ritmo = (volIV / 24).toFixed(1);
                const vigFinal = (volIV * dex) / (1440 * pesoKg);

                document.getElementById('resFinalIV').innerHTML =
                    `DEXTROSA EN AGUA AL ${dex}%, PASAR INTRAVENOSO ${volIV.toFixed(1)} ML EN 24 HORAS (${ritmo} CC/H).<br>` +
                    `<span style="color:#27ae60">VIG REAL: ${vigFinal.toFixed(2)} MG/KG/MIN</span>`;
            }

            function renderMedTable() {
                const body = document.getElementById('bodyMed');
                body.innerHTML = '';
                listaMedicamentos.forEach((m, i) => {
                    let options = '<option value="">--Seleccionar--</option>';
                    for (let k in dbHSVP) options += `<option value="${k}" ${m.n === k ? 'selected' : ''}>${k}</option>`;
                    body.innerHTML += `
                <tr style="background:${m.b ? '#fff' : '#ffebee'}">
                    <td><select onchange="seleccionarMed(${i}, this.value)" style="width:100px">${options}<option value="OTRO">OTRO</option></select></td>
                    <td><input type="number" value="${m.d}" oninput="listaMedicamentos[${i}].d=this.value; recalcular()" style="width:40px"></td>
                    <td><input type="number" value="${m.f}" oninput="listaMedicamentos[${i}].f=this.value; recalcular()" style="width:40px"></td>
                    <td><input type="number" value="${m.c}" oninput="listaMedicamentos[${i}].c=this.value; recalcular()" style="width:40px"></td>
                    <td><input type="checkbox" ${m.b ? 'checked' : ''} onchange="listaMedicamentos[${i}].b=this.checked; renderMedTable()"></td>
                    <td><span id="vol_${i}">0</span></td>
                    <td><button onclick="listaMedicamentos.splice(${i},1); renderMedTable()">✖</button></td>
                </tr>`;
                });
                recalcular();
            }

            function seleccionarMed(idx, key) {
                if (dbHSVP[key]) {
                    const d = dbHSVP[key];
                    listaMedicamentos[idx] = { n: key, d: d.d, f: d.f, c: d.c, b: d.b };
                } else { listaMedicamentos[idx].n = "OTRO"; }
                renderMedTable();
            }

            function agregarFilaMed() { listaMedicamentos.push({ n: '', d: 0, f: 24, c: 1, b: true }); renderMedTable(); }

            function generarTodo() {
                document.getElementById('export-section').classList.remove('hidden');
                let out = "==== HISTORIA CLÍNICA Y PLAN DE MANEJO HSVP ====\n\n";
                out += "PACIENTE: " + document.getElementById('ape1N').value + " " + document.getElementById('ape2N').value + " " + document.getElementById('nomN').value + "\n";
                out += "HCU: " + document.getElementById('hcu').value + " | EDAD: " + document.getElementById('edadReal').value + "\n";
                out += "------------------------------------------------\n";
                out += "INDICACIONES (ADCAVANDIMELCO):\n";
                out += "A: " + document.getElementById('adm').value + "\n";
                out += "D: " + document.getElementById('diag').value + "\n";
                out += "C: " + document.getElementById('cond').value + "\n";
                out += "A: ALERGIAS " + document.getElementById('aler').value + "\n";
                out += "V: " + document.getElementById('vit_txt').value + "\n";
                out += "A: POSICIÓN " + document.getElementById('act').value + "\n";
                out += "D: DIETA " + document.getElementById('tipoDieta').value + "\n";
                out += "I: " + document.getElementById('resFinalIV').innerText + "\n";
                out += "M: MEDICAMENTOS\n";
                listaMedicamentos.forEach(m => out += "- " + m.n + ": " + m.d + " mg/kg c/" + m.f + "h\n");
                out += "E: " + document.getElementById('exa').value + "\n";
                out += "L: " + document.getElementById('lab').value + "\n";
                out += "C: " + document.getElementById('int').value + "\n";
                out += "O: " + document.getElementById('otr').value + "\n";
                document.getElementById('finalOutput').innerText = out;
                window.scrollTo(0, document.body.scrollHeight);
            }

            // --- LÓGICA AUTOGUARDADO ---
            function saveForm() {
                const data = {};
                document.querySelectorAll('input:not([type="radio"]), select, textarea').forEach(el => {
                    if (el.id) data[el.id] = el.type === 'checkbox' ? el.checked : el.value;
                });
                localStorage.setItem('hsvp_data', JSON.stringify(data));
            }

            function loadForm() {
                const data = JSON.parse(localStorage.getItem('hsvp_data'));
                if (data) {
                    document.querySelectorAll('input:not([type="radio"]), select, textarea').forEach(el => {
                        if (data[el.id] !== undefined) {
                            if (el.type === 'checkbox') el.checked = data[el.id];
                            else el.value = data[el.id];
                        }
                    });
                    generarGestaciones();
                    toggleHMuertos();
                    ['v_dt', 'v_hepb', 'v_inf', 'v_covid'].forEach(id => {
                        const cb = document.getElementById(id);
                        if (cb && cb.checked && typeof toggleDosis === 'function') {
                            toggleDosis(cb, id + '_dosis');
                        }
                    });
                    if (typeof toggleMaduracion === 'function') toggleMaduracion();
                    recalcular();
                }
            }

            document.addEventListener("input", saveForm);
            document.addEventListener("change", saveForm);

            window.onload = () => {
                loadForm();
                calcEdadAlIngreso();
                renderMedTable();
            };
        </script>
</body>

</html>
