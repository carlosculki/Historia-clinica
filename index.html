<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SISTEMA NEONATAL HSVP v22.5 - INTEGRAL BLINDADO</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); padding: 15px; font-size: 11px; color: #333; }
        .container { max-width: 1400px; margin: auto; background: white; padding: 25px; border-radius: 12px; border-top: 10px solid var(--primary); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        
        .grid-master { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        h2 { background: var(--primary); color: white; padding: 10px; border-radius: 5px; font-size: 1.2em; text-transform: uppercase; margin-top: 0; border-left: 8px solid var(--secondary); }
        .card { background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        label { font-weight: bold; display: block; margin: 8px 0 3px 0; color: #2c3e50; }
        input, select, textarea { width: 100%; padding: 7px; border: 1px solid #ccc; border-radius: 4px; font-size: 11px; box-sizing: border-box; }
        textarea { resize: vertical; }

        /* ADCAV Estilos */
        .adcav-grid { display: grid; grid-template-columns: 65px 1fr; gap: 12px; border-bottom: 1px solid #eee; padding: 12px 0; align-items: center; }
        .letra { font-weight: bold; font-size: 2.5em; color: var(--secondary); text-align: center; }
        
        /* Resultados y Alertas */
        .res-destacado { background: #fffde7; border: 2px solid #ffd54f; padding: 15px; border-radius: 8px; font-weight: bold; color: #d35400; font-size: 1.15em; line-height: 1.5; }
        .bal-false { background-color: #ffebee !important; }
        
        /* Tablas */
        .med-table { width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 10px; }
        .med-table th { background: var(--primary); color: white; padding: 6px; text-align: left; }
        .med-table td { border-bottom: 1px solid #eee; padding: 5px; }

        /* Botonera */
        .btn-copy { background: var(--accent); color: white; border: none; padding: 18px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.3em; margin-top: 25px; transition: 0.3s; }
        .btn-copy:hover { background: #219150; transform: translateY(-2px); }
        .status-save { font-size: 10px; color: var(--accent); font-weight: bold; float: right; background: #e8f5e9; padding: 4px 10px; border-radius: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <span class="status-save" id="saveStatus">üü¢ SISTEMA ACTIVO - AUTO-GUARDADO</span>
    <h1 style="color:var(--primary); margin:0 0 25px 0; border-bottom: 2px solid #eee; padding-bottom: 10px;">HISTORIA CL√çNICA NEONATAL INTELIGENTE - HSVP</h1>

    <div class="grid-master">
        
        <div id="columna-evolucion">
            <h2>1. Evoluci√≥n (Columna Izquierda Formato 005)</h2>
            
            <div class="card">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
                    <div><label>Apellidos y Nombres:</label><input id="nombre" placeholder="Ej: P√©rez Juan" oninput="save()"></div>
                    <div><label>H.C.U:</label><input id="hcu" placeholder="100..." oninput="save()"></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                    <div><label>Peso Actual (g):</label><input type="number" id="p" value="3000" oninput="recalcular()"></div>
                    <div><label>Edad (D√≠as):</label><input type="number" id="edad" value="1" oninput="save()"></div>
                    <div><label>Sexo:</label><select id="sexo" onchange="save()"><option>MASCULINO</option><option>FEMENINO</option></select></div>
                </div>
            </div>

            <div class="card">
                <label>Antecedentes Maternos y Perinatales:</label>
                <textarea id="antecedentes" rows="3" oninput="save()" placeholder="G: P: A: C: ... Grupo Sangu√≠neo... Serolog√≠a..."></textarea>
                
                <label>Examen F√≠sico (Hallazgos Relevantes):</label>
                <textarea id="examen" rows="5" oninput="save()" placeholder="Paciente activo, reactivo, piel normocoloreada... FC: FR: T: SatO2:"></textarea>
            </div>

            <div class="card">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label>Silverman-Anderson:</label>
                        <input id="silverman" placeholder="0/10" oninput="save()">
                    </div>
                    <div>
                        <label>Edad Gestacional (Ballard/Capurro):</label>
                        <input id="eg" placeholder="38.5 sem" oninput="save()">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top:10px;">
                    <div><label>Escala de Bell (ECN):</label><input id="bell" placeholder="N/A" oninput="save()"></div>
                    <div><label>Llenado Capilar:</label><input id="ll_capilar" placeholder="2 seg" oninput="save()"></div>
                </div>
            </div>

            <div class="card">
                <label>Diagn√≥sticos (CIE-10):</label>
                <textarea id="diagnosticos" rows="4" oninput="save()" placeholder="1. Reci√©n nacido a t√©rmino..."></textarea>
            </div>
        </div>

        <div id="columna-prescripciones">
            <h2>2. Prescripciones (Columna Derecha Formato 005)</h2>
            
            <div class="card" style="background:#eef2f7; border-left: 8px solid var(--secondary);">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div><label>LT (ml/kg/d):</label><input type="number" id="lt_base" value="80" oninput="recalcular()"></div>
                    <div><label>% Dextrosa:</label><input type="number" id="dex_perc" value="10" oninput="recalcular()"></div>
                </div>
                <div style="margin-top: 10px; font-size: 0.9em;">
                    <label><input type="checkbox" id="foto" onchange="recalcular()"> Fototerapia (+15% de l√≠quidos)</label>
                    <label><input type="checkbox" id="cuna" onchange="recalcular()"> Cuna Radiante (+15% de l√≠quidos)</label>
                </div>
            </div>

            <div class="adcav-grid"><div class="letra">A</div><div><label>ADMISI√ìN:</label><input id="adm" value="Neonatolog√≠a" oninput="save()"></div></div>
            
            <div class="adcav-grid"><div class="letra">D</div>
                <div>
                    <label>DIETA:</label>
                    <select id="tipoDieta" onchange="recalcular()"><option value="NPO">NADA POR VIA ORAL (NPO)</option><option value="LM">LECHE MATERNA (LM)</option></select>
                    <div id="boxDieta" class="hidden" style="margin-top:8px; background:white; padding:10px; border-radius:5px; border:1px solid #ddd;">
                        ml/toma: <input type="number" id="dCant" style="width:60px" oninput="recalcular()"> 
                        Frec(h): <input type="number" id="dFreq" style="width:60px" oninput="recalcular()" value="3">
                        <span id="resDietaTotal" style="font-weight:bold; color:var(--accent); margin-left:10px;"></span>
                    </div>
                </div>
            </div>

            <div class="adcav-grid"><div class="letra">I</div>
                <div>
                    <label>L√çQUIDOS IV Y VIG:</label>
                    <div id="resFinalIV" class="res-destacado">Calculando...</div>
                </div>
            </div>

            <div class="adcav-grid"><div class="letra">M</div>
                <div>
                    <label>MEDICAMENTOS (Diluciones HSVP 2023):</label>
                    <table class="med-table">
                        <thead>
                            <tr><th>F√°rmaco</th><th>Dosis</th><th>Frec</th><th>¬øBal?</th><th>Vol/d</th><th></th></tr>
                        </thead>
                        <tbody id="medBody"></tbody>
                    </table>
                    <button onclick="addMed()" style="margin-top:8px; padding:5px 12px; cursor:pointer; background:var(--secondary); color:white; border:none; border-radius:4px;">+ A√±adir Medicamento</button>
                </div>
            </div>

            <div class="adcav-grid"><div class="letra" style="font-size:1.5em;">V-E-L-C-O</div>
                <div>
                    <label>OTROS (Vitales, Ex√°menes, Laboratorio, etc.):</label>
                    <textarea id="velco" rows="3" oninput="save()" placeholder="Control de signos vitales cada 3 horas, Rx de t√≥rax..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <button class="btn-copy" onclick="copiarTodo()">üìã GENERAR Y COPIAR EVOLUCI√ìN COMPLETA (FORMATO 005)</button>
</div>

<script>
    // BASE DE DATOS BLINDADA HSVP 2023
    const dbHSVP = {
        "AMIKACINA": { d: 15, c: 5, f: 24, b: true },
        "AMPICILINA": { d: 50, c: 100, f: 12, b: true },
        "BICARBONATO 8,4%": { d: 2, c: 0.5, f: 24, b: true },
        "CEFTAZIDIMA": { d: 50, c: 40, f: 12, b: true },
        "CEFTRIAXONA": { d: 50, c: 40, f: 24, b: true },
        "CLORURO SODIO 20%": { d: 3, c: 3.42, f: 24, b: true },
        "CLORURO POTASIO 14.8": { d: 2, c: 2, f: 24, b: true },
        "GENTAMICINA": { d: 4, c: 4, f: 24, b: true },
        "GLUCONATO CALCIO 10%": { d: 200, c: 50, f: 24, b: true },
        "MEROPENEM": { d: 40, c: 25, f: 8, b: true },
        "METRONIDAZOL 0,5%": { d: 7.5, c: 5, f: 12, b: true },
        "VANCOMICINA": { d: 15, c: 5, f: 12, b: true }
    };

    let listaMeds = [];

    function recalcular() {
        const pesoKg = parseFloat(document.getElementById('p').value) / 1000;
        let lt = parseFloat(document.getElementById('lt_base').value) || 0;
        const dex = parseFloat(document.getElementById('dex_perc').value) || 0;

        // 1. Incrementos Blindados
        const baseLT = lt;
        if(document.getElementById('foto').checked) lt += baseLT * 0.15;
        if(document.getElementById('cuna').checked) lt += baseLT * 0.15;
        const volTotalDia = lt * pesoKg;

        // 2. Dieta Blindada
        let vDiet = 0;
        if(document.getElementById('tipoDieta').value === "LM") {
            document.getElementById('boxDieta').classList.remove('hidden');
            vDiet = (parseFloat(document.getElementById('dCant').value) || 0) * (24 / (parseFloat(document.getElementById('dFreq').value) || 1));
            document.getElementById('resDietaTotal').innerText = `Consumo: ${vDiet.toFixed(1)} ml/d√≠a`;
        } else { document.getElementById('boxDieta').classList.add('hidden'); }

        // 3. Medicamentos (Balance y Volumen)
        let vMedBal = 0;
        listaMeds.forEach((m, i) => {
            const vDia = ((pesoKg * m.d) / m.c) * (24 / m.f);
            document.getElementById(`vDia_${i}`).innerText = vDia.toFixed(2);
            if(m.b) vMedBal += vDia;
        });

        // 4. L√≠quidos IV y VIG (F√≥rmula Corregida Factor 1440)
        const vIV = volTotalDia - vDiet - vMedBal;
        const ritmo = (vIV / 24).toFixed(1);
        const vigReal = (vIV * dex) / (1440 * pesoKg);

        document.getElementById('resFinalIV').innerHTML = 
            `DEXTROSA AL ${dex}%, PASAR IV ${vIV.toFixed(1)} ML EN 24 HORAS (Ritmo: ${ritmo} CC/H).<br>` +
            `VIG REAL: ${vigReal.toFixed(2)} mg/kg/min`;
        
        save();
    }

    function renderMeds() {
        const body = document.getElementById('medBody');
        body.innerHTML = '';
        listaMeds.forEach((m, i) => {
            let opts = '<option value="">--Seleccione--</option>';
            for(let k in dbHSVP) opts += `<option value="${k}" ${m.n===k?'selected':''}>${k}</option>`;
            body.innerHTML += `
                <tr class="${!m.b ? 'bal-false' : ''}">
                    <td><select onchange="cargarMed(${i}, this.value)">${opts}<option value="OTRO">OTRO</option></select></td>
                    <td><input type="number" value="${m.d}" oninput="listaMeds[${i}].d=this.value; recalcular()" style="width:40px"></td>
                    <td><input type="number" value="${m.f}" oninput="listaMeds[${i}].f=this.value; recalcular()" style="width:35px"></td>
                    <td><input type="checkbox" ${m.b?'checked':''} onchange="listaMeds[${i}].b=this.checked; renderMeds()"></td>
                    <td><span id="vDia_${i}" style="font-weight:bold">0</span></td>
                    <td><button onclick="listaMeds.splice(${i},1); renderMeds()" style="color:red; cursor:pointer; border:none; background:none;">‚úñ</button></td>
                </tr>`;
        });
        recalcular();
    }

    function cargarMed(idx, key) {
        if(dbHSVP[key]) {
            const r = dbHSVP[key];
            listaMeds[idx] = { n: key, d: r.d, f: r.f, c: r.c, b: r.b };
        } else { listaMeds[idx].n = "OTRO"; }
        renderMeds();
    }

    function addMed() { listaMeds.push({n:'', d:0, f:24, c:1, b:true}); renderMeds(); }

    // SISTEMA DE AUTO-GUARDADO (Local Storage)
    function save() {
        const data = {
            nombre: document.getElementById('nombre').value,
            hcu: document.getElementById('hcu').value,
            p: document.getElementById('p').value,
            edad: document.getElementById('edad').value,
            ant: document.getElementById('antecedentes').value,
            ex: document.getElementById('examen').value,
            diag: document.getElementById('diagnosticos').value,
            sv: document.getElementById('silverman').value,
            eg: document.getElementById('eg').value,
            meds: listaMeds,
            velco: document.getElementById('velco').value
        };
        localStorage.setItem('hsvp_data_final', JSON.stringify(data));
        document.getElementById('saveStatus').innerText = "‚úÖ AUTO-GUARDADO: " + new Date().toLocaleTimeString();
    }

    function load() {
        const saved = localStorage.getItem('hsvp_data_final');
        if(saved) {
            const d = JSON.parse(saved);
            document.getElementById('nombre').value = d.nombre || '';
            document.getElementById('hcu').value = d.hcu || '';
            document.getElementById('p').value = d.p || 3000;
            document.getElementById('edad').value = d.edad || 1;
            document.getElementById('antecedentes').value = d.ant || '';
            document.getElementById('examen').value = d.ex || '';
            document.getElementById('diagnosticos').value = d.diag || '';
            document.getElementById('silverman').value = d.sv || '';
            document.getElementById('eg').value = d.eg || '';
            document.getElementById('velco').value = d.velco || '';
            listaMeds = d.meds || [];
            renderMeds();
        }
    }

    function copiarTodo() {
        const n = document.getElementById('nombre').value;
        const h = document.getElementById('hcu').value;
        const p = document.getElementById('p').value;
        
        const colIzquierda = `--- 1. NOTAS DE EVOLUCI√ìN (COL. IZQUIERDA) ---\n` +
            `PACIENTE: ${n} | HCU: ${h} | PESO: ${p}g | EDAD: ${document.getElementById('edad').value}d\n` +
            `ANTECEDENTES: ${document.getElementById('antecedentes').value}\n` +
            `EXAMEN F√çSICO: ${document.getElementById('examen').value}\n` +
            `ESCALAS: Silverman: ${document.getElementById('silverman').value} | EG: ${document.getElementById('eg').value} | Bell: ${document.getElementById('bell').value}\n` +
            `DIAGN√ìSTICOS: ${document.getElementById('diagnosticos').value}`;

        const colDerecha = `--- 2. PRESCRIPCIONES (COL. DERECHA) ---\n` +
            `A: ${document.getElementById('adm').value}\n` +
            `D: ${document.getElementById('tipoDieta').value} ${document.getElementById('dCant').value}ml c/${document.getElementById('dFreq').value}h\n` +
            `I: ${document.getElementById('resFinalIV').innerText}\n` +
            `M: ${listaMeds.map(m => m.n + " (" + m.d + " mg/kg)").join(", ")}\n` +
            `V-E-L-C-O: ${document.getElementById('velco').value}`;

        const full = `${colIzquierda}\n\n${colDerecha}`;
        
        navigator.clipboard.writeText(full);
        alert("Evoluci√≥n completa copiada. Lista para pegar en el Formato 005.");
    }

    window.onload = load;
</script>
</body>
</html>
