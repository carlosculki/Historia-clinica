<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HC Neonatal Integral - VERSIÓN FINAL</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 15px; font-size: 12px; color: #333; }
        .container { max-width: 1150px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); border-bottom: 4px solid var(--secondary); padding-bottom: 10px; }
        h2 { background: var(--primary); color: white; padding: 8px 12px; border-radius: 5px; margin-top: 20px; font-size: 1.1em; }
        h3 { border-left: 5px solid var(--secondary); padding-left: 10px; color: var(--secondary); margin-top: 15px; font-size: 1em; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 10px; }
        .field { display: flex; flex-direction: column; }
        .full-width { grid-column: 1 / -1; }
        label { font-weight: bold; margin-bottom: 2px; color: #555; }
        input, select, textarea { padding: 6px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; }
        textarea { min-height: 45px; }
        .calc-card { background: #eef2f7; border: 1px solid #d1d8e0; padding: 15px; border-radius: 8px; margin-top: 10px; }
        .result-box { background: #2c3e50; color: #fff; padding: 10px; border-radius: 4px; font-weight: bold; }
        .med-row { background: white; border: 1px solid #ddd; padding: 10px; border-radius: 5px; margin-bottom: 8px; }
        .adcav-item { background: #fdfdfd; border: 1px solid #eee; border-left: 4px solid var(--secondary); padding: 10px; margin-bottom: 8px; }
        .hidden { display: none; }
        .save-status { position: fixed; bottom: 15px; right: 15px; background: var(--accent); color: white; padding: 8px 15px; border-radius: 20px; font-size: 11px; opacity: 0; transition: opacity 0.5s; z-index: 1000; }
        @media print { .no-print { display: none; } .grid { grid-template-columns: 1fr 1fr !important; } }
    </style>
</head>
<body onload="cargarDatos()">

<div id="save-tag" class="save-status">✓ Autoguardado</div>

<div class="container" id="hc-form">
    <h1>Nota de Ingreso Neonatología</h1>

    <h2>1. Identificación y Filiación</h2>
    <div class="grid">
        <div class="field"><label>Nombre Neonato:</label><input type="text" id="nombreNeo" oninput="guardar()"></div>
        <div class="field"><label>F. Nacimiento:</label><input type="date" id="fNac" onchange="calcularEdad(); guardar()"></div>
        <div class="field"><label>Hora Nac.:</label><input type="time" id="hNac" oninput="guardar()"></div>
        <div class="field"><label>F. Ingreso:</label><input type="date" id="fIng" onchange="calcularEdad(); guardar()"></div>
        <div class="field"><label>Hora Ing.:</label><input type="time" id="hIng" oninput="guardar()"></div>
        <div class="field"><label>Edad Calculada:</label><input type="text" id="edadCalc" readonly style="background:#eee"></div>
        <div class="field"><label>Sexo:</label><select id="sexo" onchange="guardar()"><option>Masculino</option><option>Femenino</option><option>Indeterminado</option></select></div>
        <div class="field"><label>Raza:</label><select id="razaNeo" onchange="guardar()"><option>Mestizo</option><option>Afrodescendiente</option><option>Indígena</option><option>Otro</option></select></div>
        <div class="field"><label>Cédula:</label><input type="text" id="cedulaNeo" oninput="guardar()"></div>
    </div>

    <h2>2. Datos de los Padres</h2>
    <div class="grid">
        <div class="field"><h3>Madre</h3>
            <label>Nombre:</label><input type="text" id="nomMadre" oninput="guardar()">
            <label>Cédula:</label><input type="text" id="cedMadre" oninput="guardar()">
            <label>Teléfono:</label><input type="text" id="telMadre" oninput="guardar()">
            <label>Dirección:</label><input type="text" id="dirMadre" oninput="guardar()">
            <label>¿Cobertura?</label><select id="cobMSel" onchange="toggleC('cobMSel','cobMDet'); guardar()"><option value="no">No</option><option value="si">Si</option></select>
            <input type="text" id="cobMDet" class="hidden" placeholder="Cuál?" oninput="guardar()">
        </div>
        <div class="field"><h3>Padre</h3>
            <label>Nombre:</label><input type="text" id="nomPadre" oninput="guardar()">
            <label>Cédula:</label><input type="text" id="cedPadre" oninput="guardar()">
            <label>Teléfono:</label><input type="text" id="telPadre" oninput="guardar()">
            <label>Dirección:</label><input type="text" id="dirPadre" oninput="guardar()">
            <label>¿Cobertura?</label><select id="cobPSel" onchange="toggleC('cobPSel','cobPDet'); guardar()"><option value="no">No</option><option value="si">Si</option></select>
            <input type="text" id="cobPDet" class="hidden" placeholder="Cuál?" oninput="guardar()">
        </div>
    </div>

    <h2>3. Historia Materna y Antecedentes Médicos</h2>
    <div class="grid">
        <div class="field"><label>Edad Madre:</label><input type="number" id="edadM" oninput="guardar()"></div>
        <div class="field"><label>Raza:</label><select id="razaM" onchange="guardar()"><option>Mestizo</option><option>Afro</option><option>Indígena</option><option>Blanco</option></select></div>
        <div class="field"><label>Instrucción:</label><select id="insM" onchange="guardar()"><option>Básica</option><option>Secundaria</option><option>Superior</option></select></div>
        <div class="field"><label>Estado Civil:</label><select id="ecM" onchange="guardar()"><option>Soltera</option><option>Casada</option><option>U. Libre</option></select></div>
        <div class="field"><label>Tipo Sangre:</label><select id="sangreM" onchange="guardar()"><option>O+</option><option>O-</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>AB+</option><option>AB-</option></select></div>
    </div>
    <div class="grid">
        <div class="field full-width"><label>A. Patológicos Familiares:</label><textarea id="antFam" oninput="guardar()"></textarea></div>
        <div class="field full-width"><label>A. Patológicos Personales:</label><textarea id="antPers" oninput="guardar()"></textarea></div>
        <div class="field full-width"><label>A. Quirúrgicos:</label><textarea id="antQuir" oninput="guardar()"></textarea></div>
        <div class="field"><label>Alergias:</label><input type="text" id="alergiasM" oninput="guardar()"></div>
        <div class="field"><label>Hábitos:</label><input type="text" id="habitosM" oninput="guardar()"></div>
    </div>

    <h2>4. Antecedentes Gineco-Obstétricos</h2>
    <div class="grid">
        <div class="field"><label>Menarquia:</label><input type="text" id="menarquia" oninput="guardar()"></div>
        <div class="field"><label>Ciclos:</label><input type="text" id="ciclos" oninput="guardar()"></div>
        <div class="field"><label>IVSA:</label><input type="text" id="ivsa" oninput="guardar()"></div>
        <div class="field"><label>Parejas:</label><input type="number" id="parejas" oninput="guardar()"></div>
        <div class="field"><label>F.U.M:</label><input type="date" id="fum" onchange="calcularEG(); guardar()"></div>
        <div class="field"><label>EG por FUM:</label><input type="text" id="egFum" readonly style="background:#eee"></div>
        <div class="field"><label>Gestas/Partos/Abortos:</label><input type="text" id="gpa" placeholder="G: P: A: C:" oninput="guardar()"></div>
        <div class="field"><label>Controles Prenatales:</label><input type="number" id="controles" oninput="guardar()"></div>
        <div class="field"><label>Nº Ecos:</label><input type="number" id="ecos" oninput="guardar()"></div>
        <div class="field"><label>Ruptura Membranas:</label><select id="rpmSel" onchange="toggleC('rpmSel','rpmDiv'); guardar()"><option value="no">No</option><option value="si">Si</option></select>
            <div id="rpmDiv" class="hidden"><input type="number" id="rpmH" placeholder="Horas" oninput="guardar()"></div>
        </div>
    </div>

    <h2>5. Evolución y Examen Físico de Ingreso</h2>
    <div class="grid">
        <div class="field full-width"><label>Motivo de Consulta:</label><textarea id="motivo" oninput="guardar()"></textarea></div>
        <div class="field full-width"><label>Enfermedad Actual:</label><textarea id="enfAct" oninput="guardar()"></textarea></div>
        <div class="field"><label>FC (lpm):</label><input type="number" id="fc" oninput="guardar()"></div>
        <div class="field"><label>FR (rpm):</label><input type="number" id="fr" oninput="guardar()"></div>
        <div class="field"><label>Temp (°C):</label><input type="number" id="temp" step="0.1" oninput="guardar()"></div>
        <div class="field"><label>TA (mmHg):</label><input type="text" id="ta" oninput="guardar()"></div>
        <div class="field"><label>Peso (Kg):</label><input type="number" id="pesoGlobal" step="0.001" oninput="actualizarTodo(); guardar()"></div>
        <div class="field"><label>Talla (cm):</label><input type="number" id="talla" oninput="guardar()"></div>
    </div>
    <div class="field"><label>Diagnóstico de Ingreso:</label><textarea id="diagIng" oninput="syncDiag(); guardar()"></textarea></div>

    <h2>6. Cálculo de Líquidos, Medicamentos y VIG</h2>
    <div class="calc-card">
        <div class="grid">
            <div class="field"><label>LT (ml/kg/d):</label><input type="number" id="ltVal" oninput="actualizarTodo(); guardar()"></div>
            <div class="field"><label>Dextrosa (%):</label>
                <select id="dexPerc" onchange="actualizarTodo(); guardar()">
                    <option value="25">2.5%</option><option value="50" selected>5%</option><option value="100">10%</option><option value="125">12.5%</option>
                </select>
            </div>
            <div class="field"><label>Extras (Suman 15% c/u):</label>
                <div><input type="checkbox" class="extra-check" value="0.15" onchange="actualizarTodo(); guardar()"> Fototerapia</div>
                <div><input type="checkbox" class="extra-check" value="0.15" onchange="actualizarTodo(); guardar()"> Cuna Radiante</div>
            </div>
        </div>
        <div id="listaMedicamentos"></div>
        <button class="btn-add no-print" onclick="agregarMed()">+ Añadir Medicamento</button>
        <div class="grid" style="margin-top:10px">
            <div class="result-box" id="resTotalLiq">Líquidos Finales: 0 ml/d</div>
            <div class="result-box" id="resVig" style="background:var(--accent)">VIG: 0 mg/kg/min</div>
        </div>
    </div>

    <h2>7. Indicaciones (ADCAVANDIMELCO)</h2>
    <div id="adcav-list">
        <div class="adcav-item"><b>A (Admisión):</b> <input type="text" id="indA" style="width:70%" oninput="guardar()"></div>
        <div class="adcav-item"><b>D (Diagnóstico):</b> <textarea id="indD" style="width:100%" oninput="guardar()"></textarea></div>
        <div class="adcav-item"><b>C (Condición):</b> <select onchange="this.nextElementSibling.value=this.value; guardar()"><option value="">Seleccione...</option><option value="Estable">Estable</option><option value="Inestable">Inestable</option></select> <input type="text" id="indC" oninput="guardar()"></div>
        <div class="adcav-item"><b>A (Alergias):</b> <select onchange="this.nextElementSibling.value=this.value; guardar()"><option value="">Seleccione...</option><option value="No refiere">No refiere</option><option value="Negativo">Negativo</option></select> <input type="text" id="indAl" oninput="guardar()"></div>
        <div class="adcav-item"><b>V (Vitales):</b> <select onchange="addTxt('indV', this.value); guardar()"><option value="">Seleccione...</option><option value="Monitoreo continuo">Monitoreo continuo</option><option value="Control de signos vitales cada 3 horas">Signos c/3h</option><option value="Control ingesta excreta, balance hídrico, diuresis horaria">Balance/Diuresis</option></select><textarea id="indV" style="width:100%" oninput="guardar()"></textarea></div>
        <div class="adcav-item"><b>A (Actitud):</b> <select onchange="this.nextElementSibling.value=this.value; guardar()"><option value="">Seleccione...</option><option value="Semifowler">Semifowler</option><option value="Posición antirreflujo">Antirreflujo</option></select> <input type="text" id="indAct" oninput="guardar()"></div>
        <div class="adcav-item"><b>D (Dieta):</b> <select onchange="this.nextElementSibling.value=this.value; guardar()"><option value="">Seleccione...</option><option value="Nada por vía oral (NPO)">NPO</option></select> <input type="text" id="indDiet" oninput="guardar()"></div>
        <div class="adcav-item"><b>I (Líquidos):</b> <textarea id="indI" readonly style="width:100%; background:#eee"></textarea></div>
        <div class="adcav-item"><b>M (Medicamentos):</b> <textarea id="indM" readonly style="width:100%; background:#eee"></textarea></div>
        <div class="adcav-item"><b>E (Exámenes):</b> <select onchange="addTxt('indE', this.value); guardar()"><option value="">Seleccione...</option><option value="Radiografía toracoabdominal">Rx Toracoabdominal</option><option value="Eco transfontanelar">Eco Transfontanelar</option><option value="Eco cardiograma">Eco cardiograma</option></select><textarea id="indE" style="width:100%" oninput="guardar()"></textarea></div>
        <div class="adcav-item"><b>L (Laboratorio):</b> <select onchange="addTxt('indL', this.value); guardar()"><option value="">Seleccione...</option><option value="Biometría hematica">Biometría</option><option value="Glucosa, Urea, Creatinina">Química</option><option value="Gasometría">Gasometría</option><option value="Hemocultivo">Hemocultivo</option></select><textarea id="indL" style="width:100%" oninput="guardar()"></textarea></div>
        <div class="adcav-item"><b>C (Interconsultas):</b> <input type="text" id="indIc" style="width:70%" oninput="guardar()"></div>
        <div class="adcav-item"><b>O (Otros):</b> <input type="text" id="indO" style="width:70%" oninput="guardar()"></div>
    </div>

    <div style="text-align:center; margin-top:20px" class="no-print">
        <button onclick="window.print()" class="btn-add">Imprimir Nota</button>
        <button onclick="borrarH()" style="background:red" class="btn-add">Limpiar Todo</button>
    </div>
</div>

<script>
    const factores = { "Amikacina": 5, "Ceftazidima": 40, "Ampicilina": 100, "Cloruro de potasio": 2, "Cloruro de sodio": 3.4, "Fenobarbital": 10, "Fluconazol": 2, "Gentamicina": 4, "Gluconato de Calcio": 50, "Meropenem": 25, "Vancomicina": 5 };

    function actualizarTodo() {
        const peso = parseFloat(document.getElementById('pesoGlobal').value) || 0;
        const lt = parseFloat(document.getElementById('ltVal').value) || 0;
        const conc = parseFloat(document.getElementById('dexPerc').value) || 0;
        
        let volBase = peso * lt;
        let extraSum = 0;
        document.querySelectorAll('.extra-check:checked').forEach(c => extraSum += parseFloat(c.value));
        volBase += (volBase * extraSum);

        let vMed = 0; let tMed = "";
        document.querySelectorAll('.med-row').forEach(r => {
            const n = r.querySelector('.mn').value;
            const d = parseFloat(r.querySelector('.md').value) || 0;
            const f = parseFloat(r.querySelector('.mf').value) || 1;
            const fact = factores[n] || 1;
            const mld = (peso * d) / fact;
            vMed += (mld * f);
            tMed += `${n} pasar IV (${(peso*d).toFixed(1)} mg), cada ${Math.round(24/f)}h, (${mld.toFixed(2)} ml)\n`;
        });

        const vFinal = volBase - vMed;
        const vig = (peso > 0) ? (vFinal * conc) / (1440 * peso) : 0;

        document.getElementById('resTotalLiq').innerText = `Líquidos Finales: ${vFinal.toFixed(2)} ml/día`;
        document.getElementById('resVig').innerText = `VIG: ${vig.toFixed(2)} mg/kg/min`;
        
        const dNm = document.getElementById('dexPerc').options[document.getElementById('dexPerc').selectedIndex].text;
        document.getElementById('indI').value = `Dextrosa en agua al ${dNm}, pasar IV ${vFinal.toFixed(1)} ml en 24 horas.\nVIG: ${vig.toFixed(2)} mg/kg/min`;
        document.getElementById('indM').value = tMed;
    }

    function agregarMed(o = null) {
        const id = 'm' + Date.now();
        const div = document.createElement('div');
        div.className = 'med-row'; div.id = id;
        div.innerHTML = `<div class="grid">
            <select class="mn" onchange="actualizarTodo(); guardar()">${Object.keys(factores).map(f=>`<option value="${f}">${f}</option>`).join('')}<option>Otro</option></select>
            <input type="number" class="md" placeholder="mg/kg" oninput="actualizarTodo(); guardar()">
            <select class="mf" onchange="actualizarTodo(); guardar()"><option value="1">c/24h</option><option value="2">c/12h</option><option value="3">c/8h</option></select>
            <button onclick="document.getElementById('${id}').remove(); actualizarTodo(); guardar()" style="color:red">X</button>
        </div>`;
        document.getElementById('listaMedicamentos').appendChild(div);
        if(o){ div.querySelector('.mn').value=o.n; div.querySelector('.md').value=o.d; div.querySelector('.mf').value=o.f; }
        actualizarTodo();
    }

    function guardar() {
        const data = { v: {}, m: [], c: [] };
        document.querySelectorAll('input, select, textarea').forEach(e => { if(e.id) data.v[e.id] = e.value; });
        document.querySelectorAll('.med-row').forEach(r => data.m.push({ n: r.querySelector('.mn').value, d: r.querySelector('.md').value, f: r.querySelector('.mf').value }));
        document.querySelectorAll('.extra-check').forEach((c, i) => { if(c.checked) data.c.push(i); });
        localStorage.setItem('hc_neo_complete_v4', JSON.stringify(data));
        const s = document.getElementById('save-tag'); s.style.opacity = 1; setTimeout(()=>s.style.opacity=0, 1000);
    }

    function cargarDatos() {
        const raw = localStorage.getItem('hc_neo_complete_v4');
        if(!raw) return;
        const d = JSON.parse(raw);
        for(let id in d.v) { const e = document.getElementById(id); if(e) e.value = d.v[id]; }
        d.m.forEach(m => agregarMed(m));
        d.c.forEach(i => document.querySelectorAll('.extra-check')[i].checked = true);
        actualizarTodo(); toggleC('cobMSel','cobMDet'); toggleC('cobPSel','cobPDet'); toggleC('rpmSel','rpmDiv');
    }

    function syncDiag() { document.getElementById('indD').value = document.getElementById('diagIng').value; }
    function addTxt(id, v) { if(v) { const t = document.getElementById(id); t.value += (t.value ? ", " : "") + v; } }
    function toggleC(s, d) { const e = document.getElementById(s); if(e) document.getElementById(d).classList.toggle('hidden', e.value==='no'); }
    function calcularEdad() { /* ... */ }
    function calcularEG() { /* ... */ }
    function borrarH() { if(confirm("¿Borrar todo?")) { localStorage.removeItem('hc_neo_complete_v4'); location.reload(); } }
</script>
</body>
</html>
