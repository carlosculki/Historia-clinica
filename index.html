<div class="container" style="max-width: 1400px; margin: auto; background: white; padding: 25px; border-radius: 12px; border-top: 10px solid #2c3e50;">
    
    <div style="background: #eef2f7; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #d1d8e0;">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
            <div><label><b>Peso (g):</b></label><input type="number" id="p" value="3000" oninput="recalcular()"></div>
            <div><label><b>LT (ml/kg/d):</b></label><input type="number" id="l" value="80" oninput="recalcular()"></div>
            <div><label><b>% Dextrosa:</b></label><input type="number" id="dexPerc" value="10" oninput="recalcular()"></div>
            <div style="background: #dff9fb; padding: 10px; border-radius: 5px; border: 1px solid #81ecec;">
                <label><input type="checkbox" id="foto" onchange="recalcular()"> Fototerapia (+15%)</label><br>
                <label><input type="checkbox" id="cuna" onchange="recalcular()"> Cuna Radiante (+15%)</label>
            </div>
        </div>
    </div>

    <div id="adcav-form">
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">A</div><div><b>ADMISION:</b><input class="input-inline" id="adm" value="Neonatología"></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">D</div><div><b>DIAGNOSTICOS:</b><textarea class="input-inline" id="diag" rows="2" placeholder="Diagnósticos se cargan automáticamente..."></textarea></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">C</div><div><b>CONDICION:</b><select id="cond" class="input-inline"><option>ESTABLE</option><option>INESTABLE</option></select></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">A</div><div><b>ALERGIAS:</b><select id="aler" class="input-inline"><option>NEGATIVO</option><option>NO REFIERE</option></select></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">V</div><div><b>VITALES:</b><input id="vit_txt" class="input-inline" value="CSV cada 3 horas, Monitoreo continuo."></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">A</div><div><b>ACTITUD:</b><select id="act" class="input-inline"><option>SEMIFOWLER</option><option>POSICION ANTIRREFLUJO</option></select></div></div>

        <div class="adcav-grid">
            <div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">D</div>
            <div>
                <b>DIETA:</b>
                <select id="tipoDieta" onchange="recalcular()" class="input-inline">
                    <option value="NPO">NADA POR VIA ORAL (NPO)</option>
                    <option value="LM">LECHE MATERNA (LM)</option>
                </select>
                <div id="boxDieta" class="hidden" style="margin-top:5px; background:#f1f2f6; padding:8px; border-radius:5px;">
                    ml/toma: <input type="number" id="dietCant" value="0" style="width:50px" oninput="recalcular()"> 
                    Frec(h): <input type="number" id="dietFreq" value="3" style="width:45px" oninput="recalcular()">
                    <span id="resDietaTotal" style="margin-left:15px; font-weight:bold; color:#27ae60;"></span>
                </div>
            </div>
        </div>

        <div class="adcav-grid">
            <div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">I</div>
            <div>
                <b>LIQUIDOS INTRAVENOSOS:</b>
                <div id="resFinalIV" style="background:#fffde7; border:2px solid #ffd54f; padding:15px; border-radius:8px; font-weight:bold; color:#d35400;">
                    Calculando...
                </div>
            </div>
        </div>

        <div class="adcav-grid">
            <div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">M</div>
            <div>
                <b>MEDICAMENTOS:</b>
                <table style="width:100%; border-collapse: collapse; font-size:10px;">
                    <thead style="background:#2c3e50; color:white;">
                        <tr><th>Fármaco</th><th>Dosis</th><th>Frec</th><th>Conc</th><th>¿Bal?</th><th>Vol/d</th><th></th></tr>
                    </thead>
                    <tbody id="bodyMed"></tbody>
                </table>
                <button onclick="agregarFilaMed()" style="margin-top:5px; padding:5px 10px; cursor:pointer;">+ Añadir Fármaco</button>
            </div>
        </div>

        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">E</div><div><b>EXAMENES:</b><input class="input-inline" id="exa"></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">L</div><div><b>LAB:</b><input class="input-inline" id="lab"></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">C</div><div><b>INTERC:</b><input class="input-inline" id="int"></div></div>
        <div class="adcav-grid"><div class="letra" style="color:#3498db; font-size:2em; font-weight:bold;">O</div><div><b>OTROS:</b><input class="input-inline" id="otr"></div></div>
    </div>
</div>

<script>
    const dbHSVP = {
        "AMIKACINA": { d: 15, c: 5, f: 24, b: true },
        "AMPICILINA": { d: 50, c: 100, f: 12, b: true },
        "CEFTAZIDIMA": { d: 50, c: 40, f: 12, b: true },
        "CLORURO DE SODIO 20%": { d: 3, c: 3.42, f: 24, b: true },
        "CLORURO DE POTASIO 14.8": { d: 2, c: 2, f: 24, b: true },
        "GENTAMICINA": { d: 4, c: 4, f: 24, b: true },
        "GLUCONATO DE CALCIO 10%": { d: 200, c: 50, f: 24, b: true },
        "MEROPENEM": { d: 40, c: 25, f: 8, b: true },
        "VANCOMICINA": { d: 15, c: 5, f: 12, b: true }
    };

    let listaMedicamentos = [];

    function recalcular() {
        const pesoKg = parseFloat(document.getElementById('p').value) / 1000;
        let lt = parseFloat(document.getElementById('l').value) || 0;
        const dex = parseFloat(document.getElementById('dexPerc').value) || 0;

        // 1. Incrementos
        const base = lt;
        if(document.getElementById('foto').checked) lt += base * 0.15;
        if(document.getElementById('cuna').checked) lt += base * 0.15;
        
        const volTotal = lt * pesoKg;

        // 2. Dieta
        let vDiet = 0;
        const dietBox = document.getElementById('boxDieta');
        if(document.getElementById('tipoDieta').value === "LM") {
            dietBox.style.display = 'block';
            vDiet = (parseFloat(document.getElementById('dietCant').value) || 0) * (24 / (parseFloat(document.getElementById('dietFreq').value) || 1));
            document.getElementById('resDietaTotal').innerText = `(-${vDiet.toFixed(1)} ml/día)`;
        } else { dietBox.style.display = 'none'; }

        // 3. Medicamentos (Volumen real día)
        let vMedTotal = 0;
        listaMedicamentos.forEach((m, i) => {
            const vDia = ((pesoKg * m.d) / m.c) * (24 / m.f);
            document.getElementById(`vol_${i}`).innerText = vDia.toFixed(2);
            if(m.b) vMedTotal += vDia;
        });

        // 4. HIDRATACION FINAL (LA BOLSA)
        const volIV = volTotal - vDiet - vMedTotal;
        const ritmo = (volIV / 24).toFixed(1);

        // 5. VIG CORREGIDA (Factor 1440 * pesoKg)
        // VIG = (VolIV_dia * %Dextrosa) / (1440 * PesoKg)
        const vigFinal = (volIV * dex) / (1440 * pesoKg);

        document.getElementById('resFinalIV').innerHTML = 
            `DEXTROSA EN AGUA AL ${dex}%, PASAR INTRAVENOSO ${volIV.toFixed(1)} ML EN 24 HORAS (${ritmo} CC/H).<br>` +
            `VIG REAL: ${vigFinal.toFixed(2)} MG/KG/MIN`;
    }

    function renderMedTable() {
        const body = document.getElementById('bodyMed');
        body.innerHTML = '';
        listaMedicamentos.forEach((m, i) => {
            let options = '<option value="">--Sel--</option>';
            for(let k in dbHSVP) options += `<option value="${k}" ${m.n===k?'selected':''}>${k}</option>`;
            body.innerHTML += `
                <tr style="background:${m.b?'#fff':'#ffebee'}">
                    <td><select onchange="seleccionarMed(${i}, this.value)">${options}<option value="OTRO">OTRO</option></select></td>
                    <td><input type="number" value="${m.d}" oninput="listaMedicamentos[${i}].d=this.value; recalcular()" style="width:40px"></td>
                    <td><input type="number" value="${m.f}" oninput="listaMedicamentos[${i}].f=this.value; recalcular()" style="width:40px"></td>
                    <td><input type="number" value="${m.c}" oninput="listaMedicamentos[${i}].c=this.value; recalcular()" style="width:40px"></td>
                    <td><input type="checkbox" ${m.b?'checked':''} onchange="listaMedicamentos[${i}].b=this.checked; renderMedTable()"></td>
                    <td><span id="vol_${i}">0</span></td>
                    <td><button onclick="listaMedicamentos.splice(${i},1); renderMedTable()">✖</button></td>
                </tr>`;
        });
        recalcular();
    }

    function seleccionarMed(idx, key) {
        if(dbHSVP[key]) {
            const d = dbHSVP[key];
            listaMedicamentos[idx] = { n: key, d: d.d, f: d.f, c: d.c, b: d.b };
        } else {
            listaMedicamentos[idx].n = "OTRO";
        }
        renderMedTable();
    }

    function agregarFilaMed() { listaMedicamentos.push({n:'', d:0, f:24, c:1, b:true}); renderMedTable(); }
    
    window.onload = recalcular;
</script>
