<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SISTEMA NEONATAL HSVP v26.0 - INTEGRAL MASTER (ESTILO v10)</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); padding: 15px; font-size: 11px; color: #333; }
        .container { max-width: 1550px; margin: auto; background: white; padding: 25px; border-radius: 12px; border-top: 10px solid var(--primary); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .grid-master { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        h2 { background: var(--primary); color: white; padding: 12px; border-radius: 5px; font-size: 1.25em; text-transform: uppercase; border-left: 10px solid var(--secondary); margin-bottom: 20px; }
        .card { background: #fff; border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        label { font-weight: bold; display: block; margin: 12px 0 5px 0; color: #2c3e50; text-transform: uppercase; font-size: 0.9em; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 11px; box-sizing: border-box; background: #fdfdfd; }
        textarea { resize: vertical; line-height: 1.5; }
        
        /* ADCAV Estilo */
        .adcav-grid { display: grid; grid-template-columns: 80px 1fr; gap: 15px; border-bottom: 1px solid #eee; padding: 15px 0; align-items: center; }
        .letra { font-weight: bold; font-size: 3em; color: var(--secondary); text-align: center; font-family: 'Arial Black', sans-serif; }
        
        /* Resultados */
        .res-final { background: #fffde7; border: 2px solid #ffd54f; padding: 20px; border-radius: 8px; font-weight: bold; color: #d35400; font-size: 1.25em; margin-top: 10px; }
        
        /* Tablas */
        .med-table { width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 15px; }
        .med-table th { background: var(--primary); color: white; padding: 10px; text-align: left; }
        .med-table td { border-bottom: 1px solid #eee; padding: 8px; }

        /* Botonera */
        .btn-copy { background: #e67e22; color: white; border: none; padding: 22px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.5em; margin-top: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-copy:hover { background: #d35400; }
        .status-save { font-size: 11px; color: var(--accent); font-weight: bold; float: right; background: #e8f5e9; padding: 6px 15px; border-radius: 20px; border: 1px solid var(--accent); }
        .hidden { display: none; }

        /* Vista Previa de Copia */
        #vistaPrevia { display: none; position: fixed; top: 5%; left: 5%; width: 90%; height: 85%; background: white; z-index: 1000; border: 5px solid var(--primary); border-radius: 15px; padding: 30px; overflow-y: auto; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .vp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .vp-col { background: #f9f9f9; padding: 20px; border: 1px dashed #999; white-space: pre-wrap; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <span class="status-save" id="saveStatus">üü¢ MEMORIA v10 RESTAURADA</span>
    <h1 style="color:var(--primary); margin:0 0 30px 0; text-align:center;">HISTORIA CL√çNICA NEONATAL INTEGRAL HSVP</h1>

    <div class="grid-master">
        <div>
            <h2>1. EVOLUCI√ìN (Columna Izquierda Formato 005)</h2>
            
            <div class="card">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                    <div><label>Nombres y Apellidos:</label><input id="nombre" oninput="recalcular()"></div>
                    <div><label>H.C.U:</label><input id="hcu" oninput="recalcular()"></div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                    <div><label>Peso (g):</label><input type="number" id="p" value="3000" oninput="recalcular()"></div>
                    <div><label>Talla (cm):</label><input id="talla" oninput="save()"></div>
                    <div><label>PC (cm):</label><input id="pc" oninput="save()"></div>
                    <div><label>Edad:</label><input id="edad" oninput="save()"></div>
                </div>
            </div>

            <div class="card">
                <label>Antecedentes Maternos (Gesta, Grupo, Serolog√≠a, Ruptura):</label>
                <textarea id="ant_mat" rows="4" oninput="save()"></textarea>
                <label>Antecedentes Perinatales (Parto, APGAR, Reanimaci√≥n):</label>
                <textarea id="ant_per" rows="4" oninput="save()"></textarea>
            </div>

            <div class="card">
                <label>Examen F√≠sico Segmentario:</label>
                <textarea id="ex_piel" rows="2" placeholder="PIEL: Color, turgencia..." oninput="save()"></textarea>
                <textarea id="ex_cabeza" rows="2" placeholder="CABEZA: Fontanelas, suturas..." oninput="save()"></textarea>
                <textarea id="ex_torax" rows="2" placeholder="T√ìRAX Y PULMONES: Murmullo, ruidos..." oninput="save()"></textarea>
                <textarea id="ex_corazon" rows="2" placeholder="CORAZ√ìN: R1, R2, Soplos..." oninput="save()"></textarea>
                <textarea id="ex_abdomen" rows="2" placeholder="ABDOMEN: Blando, ruidos, cord√≥n..." oninput="save()"></textarea>
                <textarea id="ex_neuro" rows="2" placeholder="NEUROL√ìGICO: Reflejos, tono..." oninput="save()"></textarea>
            </div>

            <div class="card">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div><label>Silverman-Anderson:</label><input id="silv" value="0/10" oninput="save()"></div>
                    <div><label>Capurro/Ballard:</label><input id="eg" placeholder="38 sem" oninput="save()"></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top:10px;">
                    <div><label>Escala de Bell:</label><input id="bell" placeholder="N/A" oninput="save()"></div>
                    <div><label>Llenado Capilar:</label><input id="ll_capilar" value="2 seg" oninput="save()"></div>
                </div>
            </div>

            <div class="card">
                <label>Diagn√≥sticos (CIE-10):</label>
                <textarea id="diagnosticos" rows="4" oninput="save()"></textarea>
            </div>
        </div>

        <div>
            <h2>2. PRESCRIPCIONES (Columna Derecha Formato 005)</h2>

            <div class="card" style="background:#eef2f7; border: 2px solid var(--secondary);">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div><label>L√≠quidos Totales (ml/kg/d):</label><input type="number" id="lt_base" value="80" oninput="recalcular()"></div>
                    <div><label>% Dextrosa:</label><input type="number" id="dex_perc" value="10" oninput="recalcular()"></div>
                </div>
                <div style="margin-top: 15px;">
                    <label><input type="checkbox" id="foto" onchange="recalcular()"> Incremento Fototerapia (+15%)</label>
                    <label><input type="checkbox" id="cuna" onchange="recalcular()"> Incremento Cuna Radiante (+15%)</label>
                </div>
            </div>

            <div class="adcav-grid"><div class="letra">A</div><input id="adm" value="Neonatolog√≠a" oninput="save()"></div>
            <div class="adcav-grid"><div class="letra">D</div>
                <div>
                    <select id="tipoDieta" onchange="recalcular()">
                        <option value="NPO">NPO (NADA POR VIA ORAL)</option>
                        <option value="LM">LM (LECHE MATERNA)</option>
                    </select>
                    <div id="boxDieta" class="hidden" style="margin-top:10px;">
                        ml: <input type="number" id="dCant" style="width:60px" oninput="recalcular()"> c/ <input type="number" id="dFreq" style="width:60px" oninput="recalcular()" value="3"> horas
                        <span id="resDietaTotal" style="font-weight:bold; color:var(--accent); margin-left:15px;"></span>
                    </div>
                </div>
            </div>
            <div class="adcav-grid"><div class="letra">C</div><input id="cuidados" value="Enfermer√≠a seg√∫n protocolo" oninput="save()"></div>
            <div class="adcav-grid"><div class="letra">A</div><input id="alergias" value="No conocidas" oninput="save()"></div>
            <div class="adcav-grid"><div class="letra">V</div><input id="vitales" value="Control c/3h" oninput="save()"></div>
            
            <div class="adcav-grid"><div class="letra">I</div>
                <div><div id="resFinalIV" class="res-final">Cargando c√°lculos...</div></div>
            </div>

            <div class="adcav-grid"><div class="letra">M</div>
                <div>
                    <table class="med-table">
                        <thead><tr><th>F√°rmaco</th><th>Dosis</th><th>Frec</th><th>¬øBal?</th><th>Vol/d</th><th></th></tr></thead>
                        <tbody id="medBody"></tbody>
                    </table>
                    <button onclick="addMed()" style="margin-top:10px; padding:8px; cursor:pointer;">+ Agregar Medicamento</button>
                </div>
            </div>

            <div class="adcav-grid"><div class="letra">E-L-C-O</div>
                <div><textarea id="elco" rows="4" oninput="save()" placeholder="Ex√°menes, Laboratorio, Otros..."></textarea></div>
            </div>
        </div>
    </div>

    <button class="btn-copy" onclick="generarVistaPrevia()">üìã GENERAR VISTA PREVIA PARA COPIAR AL FORMULARIO 005</button>
</div>

<div id="vistaPrevia">
    <button onclick="this.parentElement.style.display='none'" style="float:right; background:red; color:white; border:none; padding:10px; cursor:pointer; font-weight:bold;">CERRAR</button>
    <h2 style="background:var(--accent)">VISTA PREVIA DE COPIADO (CONTROL+C / CONTROL+V)</h2>
    <div class="vp-grid">
        <div>
            <label style="color:var(--primary)">>>> COLUMNA 1: EVOLUCI√ìN</label>
            <div id="vp_evolucion" class="vp-col"></div>
        </div>
        <div>
            <label style="color:var(--primary)">>>> COLUMNA 2: PRESCRIPCIONES</label>
            <div id="vp_prescripciones" class="vp-col"></div>
        </div>
    </div>
</div>

<script>
    const dbHSVP = {
        "AMIKACINA": { d: 15, c: 5, f: 24, b: true },
        "AMPICILINA": { d: 50, c: 100, f: 12, b: true },
        "CEFTAZIDIMA": { d: 50, c: 40, f: 12, b: true },
        "CEFTRIAXONA": { d: 50, c: 40, f: 24, b: true },
        "GLUCONATO CALCIO 10%": { d: 200, c: 50, f: 24, b: true }
    };

    let listaMeds = [];

    function recalcular() {
        const pesoKg = parseFloat(document.getElementById('p').value) / 1000;
        let lt = parseFloat(document.getElementById('lt_base').value) || 0;
        const dex = parseFloat(document.getElementById('dex_perc').value) || 0;

        if(document.getElementById('foto').checked) lt += parseFloat(document.getElementById('lt_base').value) * 0.15;
        if(document.getElementById('cuna').checked) lt += parseFloat(document.getElementById('lt_base').value) * 0.15;
        const volTotalDia = lt * pesoKg;

        let vDiet = 0;
        if(document.getElementById('tipoDieta').value === "LM") {
            document.getElementById('boxDieta').classList.remove('hidden');
            vDiet = (parseFloat(document.getElementById('dCant').value) || 0) * (24 / (parseFloat(document.getElementById('dFreq').value) || 1));
            document.getElementById('resDietaTotal').innerText = `(${vDiet.toFixed(1)} ml/d√≠a)`;
        } else { document.getElementById('boxDieta').classList.add('hidden'); }

        let vMedBal = 0;
        listaMeds.forEach((m, i) => {
            const vDia = ((pesoKg * m.d) / m.c) * (24 / m.f);
            document.getElementById(`vDia_${i}`).innerText = vDia.toFixed(2);
            if(m.b) vMedBal += vDia;
        });

        const vIV = volTotalDia - vDiet - vMedBal;
        const ritmo = (vIV / 24).toFixed(1);
        const vig = (vIV * dex) / (1440 * pesoKg);

        document.getElementById('resFinalIV').innerHTML = 
            `DEXTROSA AL ${dex}%, PASAR IV ${vIV.toFixed(1)} ML EN 24 HORAS (${ritmo} CC/H). VIG: ${vig.toFixed(2)}`;
        
        save();
    }

    function renderMeds() {
        const body = document.getElementById('medBody');
        body.innerHTML = '';
        listaMeds.forEach((m, i) => {
            let opts = '<option value="">--Seleccione--</option>';
            for(let k in dbHSVP) opts += `<option value="${k}" ${m.n===k?'selected':''}>${k}</option>`;
            body.innerHTML += `<tr>
                <td><select onchange="cargarMed(${i}, this.value)">${opts}<option value="OTRO">OTRO</option></select></td>
                <td><input type="number" value="${m.d}" oninput="listaMeds[${i}].d=this.value; recalcular()" style="width:45px"></td>
                <td><input type="number" value="${m.f}" oninput="listaMeds[${i}].f=this.value; recalcular()" style="width:35px"></td>
                <td><input type="checkbox" ${m.b?'checked':''} onchange="listaMeds[${i}].b=this.checked; renderMeds()"></td>
                <td><span id="vDia_${i}">0</span></td>
                <td><button onclick="listaMeds.splice(${i},1); renderMeds()">‚úñ</button></td>
            </tr>`;
        });
        recalcular();
    }

    function cargarMed(idx, key) {
        if(dbHSVP[key]) {
            const r = dbHSVP[key];
            listaMeds[idx] = { n: key, d: r.d, f: r.f, c: r.c, b: r.b };
        } else { listaMeds[idx].n = "OTRO"; }
        renderMeds();
    }

    function addMed() { listaMeds.push({n:'', d:0, f:24, c:1, b:true}); renderMeds(); }

    function save() {
        const data = {
            nom: document.getElementById('nombre').value, h: document.getElementById('hcu').value, p: document.getElementById('p').value,
            am: document.getElementById('ant_mat').value, ap: document.getElementById('ant_per').value,
            ep: document.getElementById('ex_piel').value, ec: document.getElementById('ex_cabeza').value, et: document.getElementById('ex_torax').value,
            er: document.getElementById('ex_corazon').value, ea: document.getElementById('ex_abdomen').value, en: document.getElementById('ex_neuro').value,
            sil: document.getElementById('silv').value, eg: document.getElementById('eg').value, diag: document.getElementById('diagnosticos').value,
            meds: listaMeds, elco: document.getElementById('elco').value
        };
        localStorage.setItem('hsvp_v26_master', JSON.stringify(data));
        document.getElementById('saveStatus').innerText = "‚úÖ AUTO-GUARDADO ACTIVO";
    }

    function load() {
        const saved = localStorage.getItem('hsvp_v26_master');
        if(saved) {
            const d = JSON.parse(saved);
            document.getElementById('nombre').value = d.nom || '';
            document.getElementById('hcu').value = d.h || '';
            document.getElementById('p').value = d.p || 3000;
            document.getElementById('ant_mat').value = d.am || '';
            document.getElementById('ant_per').value = d.ap || '';
            document.getElementById('ex_piel').value = d.ep || '';
            document.getElementById('ex_cabeza').value = d.ec || '';
            document.getElementById('ex_torax').value = d.et || '';
            document.getElementById('ex_corazon').value = d.er || '';
            document.getElementById('ex_abdomen').value = d.ea || '';
            document.getElementById('ex_neuro').value = d.en || '';
            document.getElementById('silv').value = d.sil || '0/10';
            document.getElementById('eg').value = d.eg || '';
            document.getElementById('diagnosticos').value = d.diag || '';
            document.getElementById('elco').value = d.elco || '';
            listaMeds = d.meds || [];
            renderMeds();
        }
    }

    function generarVistaPrevia() {
        const evol = 
            `PACIENTE: ${document.getElementById('nombre').value}\nHCU: ${document.getElementById('hcu').value}\n` +
            `PESO: ${document.getElementById('p').value}g | TALLA: ${document.getElementById('talla').value}cm | EDAD: ${document.getElementById('edad').value}\n\n` +
            `ANTECEDENTES MATERNOS: ${document.getElementById('ant_mat').value}\n` +
            `ANTECEDENTES PERINATALES: ${document.getElementById('ant_per').value}\n\n` +
            `EXAMEN F√çSICO:\n- ${document.getElementById('ex_piel').value}\n- ${document.getElementById('ex_cabeza').value}\n- ${document.getElementById('ex_torax').value}\n` +
            `- ${document.getElementById('ex_corazon').value}\n- ${document.getElementById('ex_abdomen').value}\n- ${document.getElementById('ex_neuro').value}\n\n` +
            `ESCALAS: Silverman: ${document.getElementById('silv').value} | EG: ${document.getElementById('eg').value} | Bell: ${document.getElementById('bell').value}\n\n` +
            `DIAGN√ìSTICOS:\n${document.getElementById('diagnosticos').value}`;

        const presc = 
            `A: ${document.getElementById('adm').value}\n` +
            `D: ${document.getElementById('tipoDieta').value} ${document.getElementById('dCant').value}ml c/${document.getElementById('dFreq').value}h\n` +
            `C: ${document.getElementById('cuidados').value}\n` +
            `A: ${document.getElementById('alergias').value}\n` +
            `V: ${document.getElementById('vitales').value}\n` +
            `I: ${document.getElementById('resFinalIV').innerText}\n` +
            `M: ${listaMeds.map(m => m.n + " " + m.d + "mg/kg").join(", ")}\n` +
            `E-L-C-O: ${document.getElementById('elco').value}`;

        document.getElementById('vp_evolucion').innerText = evol;
        document.getElementById('vp_prescripciones').innerText = presc;
        document.getElementById('vistaPrevia').style.display = 'block';
    }

    window.onload = load;
</script>
</body>
</html>
