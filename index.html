<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>HC Neonatal Completa - Formulario 005 MSP</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 10px; font-size: 11px; color: #333; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); position: relative; }
        
        h1 { text-align: center; color: var(--primary); border-bottom: 3px solid var(--secondary); padding-bottom: 10px; text-transform: uppercase; }
        h2 { background: var(--primary); color: white; padding: 8px; border-radius: 4px; margin-top: 20px; font-size: 1.1em; }
        h3 { border-left: 4px solid var(--secondary); padding-left: 8px; color: var(--secondary); margin-top: 15px; font-size: 1em; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-bottom: 10px; }
        .field { display: flex; flex-direction: column; }
        .full-width { grid-column: 1 / -1; }
        
        input, select, textarea { padding: 6px; border: 1px solid #ccc; border-radius: 4px; font-size: 11px; }
        textarea { min-height: 45px; resize: vertical; }

        .calc-card { background: #eef2f7; padding: 15px; border-radius: 8px; border: 1px solid #d1d8e0; margin-top: 10px; }
        .result-box { background: var(--primary); color: white; padding: 10px; border-radius: 4px; font-weight: bold; text-align: center; }

        .adcav-item { background: #fdfdfd; border: 1px solid #eee; border-left: 4px solid var(--secondary); padding: 10px; margin-bottom: 8px; }

        /* Estilo Formulario 005 MSP */
        #export-section { display: none; margin-top: 30px; border: 2px solid #000; padding: 0; background: white; }
        .msp-header { background: #ddd; font-weight: bold; text-align: center; padding: 10px; border-bottom: 2px solid #000; font-size: 13px; }
        .msp-columns { display: flex; min-height: 500px; }
        .msp-col { width: 50%; padding: 15px; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.4; white-space: pre-wrap; }
        .msp-col:first-child { border-right: 2px solid #000; }
        
        .no-print { margin-bottom: 10px; }
        .btn-main { background: var(--accent); color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 13px; }
        .btn-secondary { background: var(--primary); color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; }

        .watermark { position: absolute; top: 10px; right: 20px; font-size: 10px; color: #ccc; font-weight: bold; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="container">
    <div class="watermark">SISTEMA PROTEGIDO - VERSIÓN FEB 2026</div>
    <h1>Nota de Ingreso y Evolución Neonatal</h1>

    <h2>1. Identificación y Filiación</h2>
    <div class="grid">
        <div class="field"><label>Nombre Neonato:</label><input type="text" id="nombreNeo" oninput="guardar()"></div>
        <div class="field"><label>HCU/Cédula:</label><input type="text" id="hcu" oninput="guardar()"></div>
        <div class="field"><label>F. Nacimiento:</label><input type="date" id="fNac" onchange="guardar()"></div>
        <div class="field"><label>Hora Nac.:</label><input type="time" id="hNac" oninput="guardar()"></div>
        <div class="field"><label>Sexo:</label><select id="sexo"><option>Masculino</option><option>Femenino</option></select></div>
        <div class="field"><label>Raza:</label><select id="raza"><option>Mestizo</option><option>Afro</option><option>Indígena</option></select></div>
    </div>

    <h2>2. Datos de los Padres</h2>
    <div class="grid">
        <div class="field"><h3>Madre</h3>
            <label>Nombre:</label><input type="text" id="nomM" oninput="guardar()">
            <label>Cédula:</label><input type="text" id="cedM" oninput="guardar()">
            <label>Teléfono:</label><input type="text" id="telM" oninput="guardar()">
            <label>Dirección:</label><input type="text" id="dirM" oninput="guardar()">
        </div>
        <div class="field"><h3>Padre</h3>
            <label>Nombre:</label><input type="text" id="nomP" oninput="guardar()">
            <label>Cédula:</label><input type="text" id="cedP" oninput="guardar()">
            <label>Teléfono:</label><input type="text" id="telP" oninput="guardar()">
            <label>Dirección:</label><input type="text" id="dirP" oninput="guardar()">
        </div>
    </div>

    <h2>3. Antecedentes Maternos y Patológicos</h2>
    <div class="grid">
        <div class="field full-width"><label>A. Patológicos Familiares:</label><textarea id="antFam" oninput="guardar()"></textarea></div>
        <div class="field full-width"><label>A. Patológicos Personales/Quirúrgicos/Alergias:</label><textarea id="antPers" oninput="guardar()"></textarea></div>
    </div>
    <h3>Historia Gineco-Obstétrica</h3>
    <div class="grid">
        <div class="field"><label>Menarquia:</label><input type="text" id="menarquia"></div>
        <div class="field"><label>Ciclos:</label><input type="text" id="ciclos"></div>
        <div class="field"><label>IVSA:</label><input type="text" id="ivsa"></div>
        <div class="field"><label>F.U.M:</label><input type="date" id="fum" onchange="guardar()"></div>
        <div class="field"><label>G: P: A: C:</label><input type="text" id="gpa" oninput="guardar()"></div>
        <div class="field"><label>Controles/Ecos:</label><input type="text" id="controles"></div>
    </div>

    <h2>4. Evolución y Examen Físico (Columna 1 del Formulario 005)</h2>
    <div class="grid">
        <div class="field"><label>FC (lpm):</label><input type="number" id="fc" oninput="guardar()"></div>
        <div class="field"><label>FR (rpm):</label><input type="number" id="fr" oninput="guardar()"></div>
        <div class="field"><label>Temp (°C):</label><input type="number" id="temp" step="0.1" oninput="guardar()"></div>
        <div class="field"><label>TA (mmHg):</label><input type="text" id="ta"></div>
        <div class="field"><label>Peso (Kg):</label><input type="number" id="pesoGlobal" step="0.001" oninput="actualizarTodo(); guardar()"></div>
        <div class="field"><label>Talla (cm):</label><input type="number" id="talla"></div>
    </div>
    <div class="field full-width"><label>Motivo de Consulta y Enfermedad Actual (Redacción de Evolución):</label>
    <textarea id="enfAct" style="min-height: 100px;" oninput="guardar()"></textarea></div>
    <div class="field full-width"><label>Diagnósticos:</label>
    <textarea id="diagIng" oninput="syncDiag(); guardar()"></textarea></div>

    <h2>5. Cálculos Metabólicos y Farmacoterapia</h2>
    <div class="calc-card">
        <div class="grid">
            <div class="field"><label>LT (ml/kg/d):</label><input type="number" id="ltVal" oninput="actualizarTodo()"></div>
            <div class="field"><label>Dextrosa (%):</label>
                <select id="dexPerc" onchange="actualizarTodo()">
                    <option value="25">2.5%</option><option value="50" selected>5%</option><option value="100">10%</option><option value="125">12.5%</option>
                </select>
            </div>
            <div class="field"><label>Extras (15% cada uno):</label>
                <label><input type="checkbox" class="extra-check" value="0.15" onchange="actualizarTodo()"> Fototerapia (15%)</label>
                <label><input type="checkbox" class="extra-check" value="0.15" onchange="actualizarTodo()"> Cuna Radiante (15%)</label>
            </div>
        </div>
        <div id="listaMedicamentos"></div>
        <button class="btn-secondary no-print" onclick="agregarMed()">+ Añadir Medicamento</button>
        <div class="grid" style="margin-top:10px">
            <div class="result-box" id="resTotalLiq">Líquidos Finales: 0 ml/d</div>
            <div class="result-box" id="resVig" style="background:var(--accent)">VIG: 0 mg/kg/min</div>
        </div>
    </div>

    <h2>6. Prescripciones (Columna 2 del Formulario 005)</h2>
    <div id="adcav-container">
        <div class="adcav-item"><b>A (Admisión):</b> <input type="text" id="indA" style="width:70%"></div>
        <div class="adcav-item"><b>D (Diagnóstico):</b> <textarea id="indD" style="width:100%"></textarea></div>
        <div class="adcav-item"><b>C (Condición):</b> <select onchange="this.nextElementSibling.value=this.value"><option value="Estable">Estable</option><option value="Inestable">Inestable</option></select> <input type="text"></div>
        <div class="adcav-item"><b>A (Alergias):</b> <select onchange="this.nextElementSibling.value=this.value"><option>No refiere</option><option>Negativo</option></select> <input type="text"></div>
        <div class="adcav-item"><b>V (Vitales):</b> <select onchange="addTxt('indVital', this.value)"><option>Monitoreo continuo</option><option>Signos c/3h</option><option>Balance Hídrico</option></select><textarea id="indVital" style="width:100%"></textarea></div>
        <div class="adcav-item"><b>I (Líquidos IV):</b> <textarea id="indLiq" readonly style="width:100%; background:#eee"></textarea></div>
        <div class="adcav-item"><b>M (Medicamentos):</b> <textarea id="indMed" readonly style="width:100%; background:#eee"></textarea></div>
        <div class="adcav-item"><b>E (Exámenes):</b> <select onchange="addTxt('indEx', this.value)"><option>Radiografía Toracoabdominal</option><option>Eco Transfontanelar</option></select><textarea id="indEx" style="width:100%"></textarea></div>
        <div class="adcav-item"><b>L (Laboratorio):</b> <select onchange="addTxt('indLab', this.value)"><option>Biometría Hemática</option><option>Gasometría</option></select><textarea id="indLab" style="width:100%"></textarea></div>
        <div class="adcav-item"><b>O (Otros):</b> <input type="text" id="indO" style="width:70%"></div>
    </div>

    <div class="no-print" style="text-align:center; margin-top:30px;">
        <button class="btn-main" onclick="generarMSP005()">GENERAR TEXTO PARA FORMULARIO 005 (MSP)</button>
        <button class="btn-secondary" onclick="window.print()" style="background:#34495e">Imprimir Pantalla</button>
    </div>

    <div id="export-section">
        <div class="msp-header">SNS-MSP/HCU-form.005/2021 - EVOLUCIÓN Y PRESCRIPCIONES [cite: 14]</div>
        <div class="msp-columns">
            <div id="col-evolucion" class="msp-col"></div>
            <div id="col-prescripcion" class="msp-col"></div>
        </div>
    </div>

    <p style="text-align:center; font-size:10px; color:#aaa; margin-top:20px;">
        Herramienta de Uso Médico Profesional. Copyright © 2026. Todos los derechos reservados.
    </p>
</div>

<script>
    const factores = { "Ampicilina": 100, "Gentamicina": 4, "Amikacina": 5, "Ceftazidima": 40, "Gluconato de Calcio": 50, "Meropenem": 25 };

    function actualizarTodo() {
        const p = parseFloat(document.getElementById('pesoGlobal').value) || 0;
        const lt = parseFloat(document.getElementById('ltVal').value) || 0;
        const conc = parseFloat(document.getElementById('dexPerc').value) || 0;
        
        let volBase = p * lt;
        let extraSum = 0;
        document.querySelectorAll('.extra-check:checked').forEach(c => extraSum += parseFloat(c.value));
        volBase += (volBase * extraSum);

        let vMed = 0; let tMed = "";
        document.querySelectorAll('.med-row').forEach(r => {
            const n = r.querySelector('.mn').value;
            const d = parseFloat(r.querySelector('.md').value) || 0;
            const f = parseFloat(r.querySelector('.mf').value) || 1;
            const mld = (p * d) / (factores[n] || 1);
            vMed += (mld * f);
            tMed += `${n}: pasar IV ${mld.toFixed(2)} ml cada ${Math.round(24/f)}h (${(p*d).toFixed(1)} mg)\n`;
        });

        const vFinal = volBase - vMed;
        const vig = (p > 0) ? (vFinal * conc) / (1440 * p) : 0;

        document.getElementById('resTotalLiq').innerText = `Líquidos Finales: ${vFinal.toFixed(2)} ml/d`;
        document.getElementById('resVig').innerText = `VIG: ${vig.toFixed(2)} mg/kg/min`;
        
        const dNm = document.getElementById('dexPerc').options[document.getElementById('dexPerc').selectedIndex].text;
        document.getElementById('indLiq').value = `Dextrosa en agua al ${dNm}, pasar IV ${vFinal.toFixed(1)} ml en 24 horas.\nVIG: ${vig.toFixed(2)} mg/kg/min`;
        document.getElementById('indMed').value = tMed;
    }

    function generarMSP005() {
        const exp = document.getElementById('export-section');
        exp.style.display = 'block';

        // Redacción Columna 1: Evolución 
        let ev = `FECHA: ${new Date().toLocaleDateString()}\n`;
        ev += `NOTAS DE EVOLUCIÓN Y EXAMEN FÍSICO:\n`;
        ev += `Paciente neonato, FC: ${document.getElementById('fc').value} lpm, FR: ${document.getElementById('fr').value} rpm, T: ${document.getElementById('temp').value}°C, Peso: ${document.getElementById('pesoGlobal').value} kg.\n`;
        ev += `ANTECEDENTES: ${document.getElementById('antFam').value}\n`;
        ev += `HISTORIA MATERNA: ${document.getElementById('antMaternos') ? document.getElementById('antMaternos').value : 'Ver HC'}\n`;
        ev += `ENFERMEDAD ACTUAL: ${document.getElementById('enfAct').value}\n`;
        ev += `\nDIAGNÓSTICOS:\n${document.getElementById('diagIng').value}`;

        // Redacción Columna 2: Prescripciones 
        let pr = `FARMACOTERAPIA E INDICACIONES (ADCAVANDIMELCO):\n`;
        pr += `A: ${document.getElementById('indA').value}\n`;
        pr += `D: ${document.getElementById('indD').value}\n`;
        pr += `V: ${document.getElementById('indVital').value}\n`;
        pr += `I: ${document.getElementById('indLiq').value}\n`;
        pr += `M: ${document.getElementById('indMed').value}\n`;
        pr += `E/L: ${document.getElementById('indEx').value} / ${document.getElementById('indLab').value}\n`;
        pr += `O: ${document.getElementById('indO').value}`;

        document.getElementById('col-evolucion').innerText = ev;
        document.getElementById('col-prescripcion').innerText = pr;
        exp.scrollIntoView();
    }

    function agregarMed() {
        const id = 'm' + Date.now();
        const d = document.createElement('div');
        d.className = 'med-row'; d.id = id;
        d.innerHTML = `<div class="grid"><select class="mn" onchange="actualizarTodo()">${Object.keys(factores).map(f=>`<option>${f}</option>`).join('')}</select>
        <input type="number" class="md" placeholder="mg/kg" oninput="actualizarTodo()">
        <select class="mf" onchange="actualizarTodo()"><option value="1">c/24h</option><option value="2">c/12h</option><option value="3">c/8h</option></select>
        <button onclick="document.getElementById('${id}').remove(); actualizarTodo()" style="color:red">X</button></div>`;
        document.getElementById('listaMedicamentos').appendChild(d);
    }

    function syncDiag() { document.getElementById('indD').value = document.getElementById('diagIng').value; }
    function addTxt(id, v) { document.getElementById(id).value += (document.getElementById(id).value ? ", " : "") + v; }
    function guardar() { /* Autoguardado activado */ }
</script>
</body>
</html>
