<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NEONATAL INTEGRAL - HSVP - VERSIÓN MAESTRA CONSOLIDADA</title>
    <style>
        /* =========================================================================
           ESTILOS GENERALES Y MAQUETACIÓN (BLOQUES 1-5)
           ========================================================================= */
        :root { 
            --primary: #2c3e50; 
            --secondary: #3498db; 
            --accent: #27ae60; 
            --bg: #f4f7f6; 
            --warning: #f39c12;
            --danger: #e74c3c;
            --white: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg); 
            padding: 20px; 
            font-size: 12px; 
            color: #333; 
            line-height: 1.5;
        }

        .container { 
            max-width: 1500px; 
            margin: auto; 
            background: var(--white); 
            padding: 40px; 
            border-radius: 15px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
            border-top: 20px solid var(--primary); 
        }

        h1 { 
            text-align: center; 
            color: var(--primary); 
            text-transform: uppercase; 
            border-bottom: 6px solid var(--secondary); 
            padding-bottom: 15px; 
            margin-bottom: 35px;
            letter-spacing: 3px;
        }

        h2 { 
            background: var(--primary); 
            color: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-top: 40px; 
            font-size: 1.4em; 
            border-left: 15px solid var(--secondary); 
            text-transform: uppercase;
            box-shadow: var(--shadow);
        }

        h3 { 
            color: var(--secondary); 
            border-bottom: 2px solid #ddd; 
            margin-top: 30px; 
            font-size: 1.2em; 
            padding-bottom: 10px;
            font-weight: bold;
        }

        /* SISTEMA DE GRIDS */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 25px; 
        }

        .field { display: flex; flex-direction: column; }
        .field label { font-weight: bold; margin-bottom: 8px; color: #444; }
        .full-width { grid-column: 1 / -1; }

        input, select, textarea { 
            padding: 12px; 
            border: 2px solid #eee; 
            border-radius: 6px; 
            font-size: 12px; 
            background: #fafafa; 
            transition: all 0.3s;
        }

        input:focus, textarea:focus { 
            border-color: var(--secondary); 
            background: #fff;
            outline: none;
            box-shadow: 0 0 8px rgba(52,152,219,0.2);
        }

        .calc-card { 
            background: #f1f4f8; 
            border: 2px solid #d1d8e0; 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 25px;
        }

        .highlight-box { 
            border: 3px solid var(--secondary) !important; 
            background: #ebf5fb !important; 
            font-weight: bold; 
            text-align: center; 
            color: var(--primary);
            font-size: 1.2em;
            padding: 10px;
        }

        /* EXAMEN FÍSICO */
        .ef-row { 
            display: grid; 
            grid-template-columns: 220px 1fr; 
            gap: 20px; 
            align-items: center; 
            background: #fff; 
            padding: 15px; 
            border-bottom: 1px solid #eee; 
            transition: 0.2s;
        }
        .ef-row:hover { background: #f9f9f9; }

        /* BUSCADOR CIE-10 */
        .search-container { position: relative; width: 100%; margin-bottom: 20px; }
        #dx-search { width: 100%; padding: 15px; border: 3px solid var(--secondary); border-radius: 10px; font-size: 14px; }
        .suggestions { 
            position: absolute; 
            width: 100%; 
            background: white; 
            border: 1px solid #ddd; 
            z-index: 1000; 
            max-height: 300px; 
            overflow-y: auto; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
        }
        .suggestion-item { padding: 15px; cursor: pointer; border-bottom: 1px solid #eee; }
        .suggestion-item:hover { background: #e3f2fd; font-weight: bold; }

        /* ADCAV COMPLETO */
        .adcav-box { border: 3px solid #cbd5e0; border-radius: 15px; overflow: hidden; margin-top: 30px; }
        .adcav-row { display: grid; grid-template-columns: 120px 1fr; border-bottom: 1px solid #edf2f7; min-height: 120px; }
        .adcav-letter { 
            background: #f7fafc; 
            color: var(--secondary); 
            font-size: 5em; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-right: 6px solid var(--secondary); 
        }
        .adcav-content { padding: 25px; background: white; }

        /* TABLAS */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: var(--primary); color: white; padding: 12px; text-align: left; }
        td { border: 1px solid #ddd; padding: 10px; }

        /* BOTONES */
        .btn-main { 
            background: var(--accent); 
            color: white; 
            padding: 30px; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 22px; 
            width: 100%; 
            margin-top: 50px; 
            box-shadow: 0 10px 25px rgba(39,174,96,0.3);
            text-transform: uppercase;
        }
        .btn-main:hover { background: #219150; transform: scale(1.01); }
        .btn-del { background: var(--danger); color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>SISTEMA NEONATAL INTEGRAL - HSVP MASTER CONSOLIDADO</h1>

    <h2>1. DATOS DE FILIACIÓN Y ADMISIÓN</h2>
    <div class="calc-card">
        <div class="grid">
            <div class="field"><label>FECHA DE INGRESO:</label><input type="date" id="fIngreso" onchange="calcGlobal()"></div>
            <div class="field"><label>FECHA DE NACIMIENTO:</label><input type="date" id="fNac" onchange="calcGlobal()"></div>
            <div class="field"><label>HORA DE NACIMIENTO:</label><input type="time" id="hNac" onchange="calcGlobal()"></div>
            <div class="field"><label>EDAD AL INGRESO:</label><input type="text" id="edadReal" readonly class="highlight-box"></div>
        </div>
    </div>

    <div class="grid">
        <div class="field"><label>Apellido Paterno:</label><input type="text" id="ape1"></div>
        <div class="field"><label>Apellido Materno:</label><input type="text" id="ape2"></div>
        <div class="field"><label>Nombres:</label><input type="text" id="nom"></div>
        <div class="field"><label>HCU / Cédula:</label><input type="text" id="hcu"></div>
        <div class="field"><label>Sexo:</label><select id="sexo"><option>MASCULINO</option><option>FEMENINO</option><option>INDETERMINADO</option></select></div>
    </div>

    <h3>Datos Maternos</h3>
    <div class="grid">
        <div class="field"><label>Nombre Madre:</label><input type="text" id="nomM"></div>
        <div class="field"><label>Edad Materna:</label><input type="number" id="edadM"></div>
        <div class="field"><label>Grupo Sanguíneo:</label>
            <select id="gsM">
                <option>ORH+</option><option>ORH-</option><option>ARH+</option><option>ARH-</option>
                <option>BRH+</option><option>BRH-</option><option>ABRH+</option><option>ABRH-</option>
            </select>
        </div>
        <div class="field"><label>Religión:</label><input type="text" id="relM" value="Católica"></div>
    </div>

    <h2>2. ANTECEDENTES PERINATALES</h2>
    <div class="calc-card">
        <div class="grid">
            <div class="field"><label>FUM (Fecha Última Menstruación):</label><input type="date" id="fum" onchange="calcEG_FUM()"></div>
            <div class="field"><label>EG por FUM:</label><input type="text" id="egFum" readonly class="highlight-box"></div>
            <div class="field"><label>Gestas:</label><input type="number" id="gestas"></div>
            <div class="field"><label>Partos:</label><input type="number" id="partos"></div>
            <div class="field"><label>Hijos Vivos:</label><input type="number" id="hVivos" oninput="generarHijosDinamico()"></div>
        </div>
        <div id="contenedorHijos"></div>
    </div>

    <div class="field full-width"><label>ANTECEDENTES PRENATALES (Detallar infecciones, controles, patologías):</label><textarea id="antPre" rows="4"></textarea></div>
    <div class="field full-width" style="margin-top:15px"><label>ANTECEDENTES NATALES (Tipo parto, RPM, Líquido, Sufrimiento):</label><textarea id="antNat" rows="4"></textarea></div>
    <div class="field full-width" style="margin-top:15px"><label>ANTECEDENTES POSTNATALES (Adaptación, Reanimación):</label><textarea id="antPost" rows="4"></textarea></div>

    <h2>3. EXAMEN FÍSICO Y VALORACIÓN</h2>
    <div class="grid">
        <div class="field"><label>Peso (g):</label><input type="number" id="peso" oninput="actualizarPesoReferencia()"></div>
        <div class="field"><label>Talla (cm):</label><input type="number" id="talla"></div>
        <div class="field"><label>PC (cm):</label><input type="number" id="pCef"></div>
        <div class="field"><label>FC (lpm):</label><input type="number" id="fc"></div>
        <div class="field"><label>FR (rpm):</label><input type="number" id="fr"></div>
        <div class="field"><label>T° (°C):</label><input type="number" id="temp" step="0.1"></div>
        <div class="field"><label>SatO2 (%):</label><input type="number" id="sat"></div>
    </div>

    <div class="calc-card">
        <div class="ef-row"><div><b>ESTADO GENERAL:</b></div><textarea id="ef_1">Activo, reactivo a la manipulación, afebril, hidratado.</textarea></div>
        <div class="ef-row"><div><b>PIEL:</b></div><textarea id="ef_2">Rosada, elástica, llenado capilar < 2 seg, sin ictericia.</textarea></div>
        <div class="ef-row"><div><b>CABEZA Y CUELLO:</b></div><textarea id="ef_3">Normocéfalo, fontanelas normotensas, suturas afrontadas.</textarea></div>
        <div class="ef-row"><div><b>TÓRAX:</b></div><textarea id="ef_4">Simétrico, ruidos cardiacos rítmicos, murmullo vesicular conservado.</textarea></div>
        <div class="ef-row"><div><b>ABDOMEN:</b></div><textarea id="ef_5">Suave, deprimible, ruidos hidroaéreos presentes, no masas.</textarea></div>
        <div class="ef-row"><div><b>EXTREMIDADES:</b></div><textarea id="ef_6">Simétricas, pulsos presentes, sin malformaciones evidentes.</textarea></div>
    </div>

    <h3>Escalas Neonatales</h3>
    
    <div class="grid">
        <div class="field">
            <label>APGAR (1' / 5'):</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="ap1" placeholder="1 min" style="width:50%">
                <input type="number" id="ap5" placeholder="5 min" style="width:50%">
            </div>
        </div>
        <div class="field">
            <label>SILVERMAN-ANDERSEN:</label>
            <input type="number" id="silv" value="0">
        </div>
        <div class="field">
            <label>CAPURRO (Puntos):</label>
            <input type="number" id="pCap" oninput="calcCapurroGlobal()">
            <div id="resCap" class="highlight-box" style="margin-top:10px">EG: -- sem</div>
        </div>
    </div>

    <h2>4. DIAGNÓSTICOS (CIE-10)</h2>
    <div class="calc-card">
        <div class="search-container">
            <input type="text" id="dx-search" placeholder="Escriba el diagnóstico o código (Ej: P36, Sepsis, Ictericia)..." oninput="motorCIE10(this.value)">
            <div id="dx-sug" class="suggestions hidden"></div>
        </div>
        <table id="tablaDx">
            <thead><tr><th>Código</th><th>Descripción</th><th>Acción</th></tr></thead>
            <tbody id="bodyDx"></tbody>
        </table>
    </div>

    <h2>5. PLAN DE MANEJO (ADCAV)</h2>
    <div class="adcav-box">
        <div class="adcav-row">
            <div class="adcav-letter">A</div>
            <div class="adcav-content">
                <b>ALIMENTACIÓN:</b> 
                <select id="tipoA" onchange="toggleAlim()">
                    <option value="NPO">NPO</option><option value="LM">Leche Materna</option><option value="LF">Fórmula</option>
                </select>
                <span id="alimExtra" class="hidden">
                    | ml: <input type="number" id="mlA" style="width:70px" oninput="calcADCAVGlobal()">
                    | c/ : <input type="number" id="frA" value="3" style="width:50px" oninput="calcADCAVGlobal()"> horas
                </span>
            </div>
        </div>
        <div class="adcav-row">
            <div class="adcav-letter">D</div>
            <div class="adcav-content">
                <b>DISPOSITIVOS Y LÍQUIDOS:</b>
                <div class="grid">
                    <div class="field"><label>Meta LT (ml/kg/d):</label><input type="number" id="ltMeta" value="80" oninput="calcADCAVGlobal()"></div>
                    <div class="field"><label>% Dextrosa:</label><input type="number" id="dexP" value="10" oninput="calcADCAVGlobal()"></div>
                </div>
                <div id="outLid" class="highlight-box">Calculando Líquidos...</div>
            </div>
        </div>
        <div class="adcav-row">
            <div class="adcav-letter">C</div>
            <div class="adcav-content"><b>CONTROLES:</b> <textarea id="planC" rows="2">CSV c/4h, Control de glicemia capilar, Aseo cordón.</textarea></div>
        </div>
        <div class="adcav-row">
            <div class="adcav-letter">A</div>
            <div class="adcav-content">
                <b>ANTIBIÓTICOS / MEDS:</b>
                <table id="tablaMeds">
                    <thead><tr><th>Medicamento</th><th>Dosis (mg/kg)</th><th>Freq (h)</th><th>Resultado ml/Dosis</th><th>Acción</th></tr></thead>
                    <tbody id="bodyMeds"></tbody>
                </table>
                <button onclick="agregarFilaMed()" style="margin-top:10px; padding:8px; background:var(--primary); color:white; border:none; border-radius:5px; cursor:pointer;">+ Agregar Medicamento</button>
            </div>
        </div>
        <div class="adcav-row">
            <div class="adcav-letter">V</div>
            <div class="adcav-content"><b>VIGILANCIA:</b> <textarea id="planV" rows="2">Vigilar signos de distrés respiratorio y tolerancia oral.</textarea></div>
        </div>
    </div>

    <button class="btn-main" onclick="generarHistoriaClinicaFinal()">GENERAR VISTA PREVIA DE TODA LA HISTORIA CLÍNICA</button>

    <div id="exportArea" class="hidden" style="margin-top:40px; border:5px solid var(--primary); padding:30px; background:#fff;">
        <h2 style="margin-top:0">RESUMEN PARA HISTORIA CLÍNICA (COPIAR Y PEGAR)</h2>
        <div id="textoFinal" style="white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 13px; color: #000; padding: 20px; border: 1px solid #ccc;"></div>
        <button onclick="window.print()" class="btn-main" style="background:var(--secondary);">IMPRIMIR / PDF</button>
    </div>
</div>

<script>
    /* =========================================================================
       LÓGICA MAESTRA INTEGRAL (SIN RECORTES)
       ========================================================================= */

    // 1. Cálculos de Edad y Tiempo
    function calcGlobal() {
        const naci = document.getElementById('fNac').value;
        const ingr = document.getElementById('fIngreso').value;
        const hora = document.getElementById('hNac').value || "00:00";
        if(naci && ingr) {
            const d1 = new Date(naci + 'T' + hora);
            const d2 = new Date(ingr + 'T23:59:59');
            const diffMs = d2 - d1;
            const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));
            if(diffHrs < 48) {
                document.getElementById('edadReal').value = diffHrs + " HORAS";
            } else {
                document.getElementById('edadReal').value = Math.floor(diffHrs/24) + " DÍAS";
            }
        }
    }

    function calcEG_FUM() {
        const f = document.getElementById('fum').value;
        if(f) {
            const diff = new Date() - new Date(f);
            const sem = diff / (1000 * 60 * 60 * 24 * 7);
            document.getElementById('egFum').value = Math.floor(sem) + "." + Math.floor((sem % 1) * 7) + " SEMANAS";
        }
    }

    // 2. Generador de Hijos (Lógica Blindada original)
    function generarHijosDinamico() {
        const n = parseInt(document.getElementById('hVivos').value) || 0;
        const c = document.getElementById('contenedorHijos');
        c.innerHTML = n > 0 ? "<h4>Detalle de Hijos Vivos:</h4>" : "";
        for(let i=1; i<=n; i++) {
            c.innerHTML += `
            <div class="grid" style="background:#fff; border:1px solid #ddd; padding:10px; margin-bottom:5px;">
                <span>Hijo ${i}:</span>
                <select><option>PARTO</option><option>CESÁREA</option></select>
                <input type="number" placeholder="Edad actual">
                <input type="text" placeholder="Complicaciones">
            </div>`;
        }
    }

    // 3. Capurro
    function calcCapurroGlobal() {
        const p = parseInt(document.getElementById('pCap').value) || 0;
        if(p > 0) {
            const eg = (p + 204) / 7;
            document.getElementById('resCap').innerText = "EG: " + eg.toFixed(1) + " semanas";
        }
    }

    // 4. CIE-10 (Base de Datos Blindada Expandida)
    const dbCIE = [
        {c: "Z38.0", d: "Recién nacido vivo, único, nacido en hospital"},
        {c: "P36.9", d: "Sepsis bacteriana del recién nacido, no especificada"},
        {c: "P22.0", d: "Síndrome de dificultad respiratoria del recién nacido"},
        {c: "P22.1", d: "Taquipnea transitoria del recién nacido"},
        {c: "P59.9", d: "Ictericia neonatal, no especificada"},
        {c: "P70.4", d: "Hipoglucemia neonatal transitoria"},
        {c: "P07.3", d: "Otros recién nacidos pretérmino"},
        {c: "P21.9", d: "Asfixia del nacimiento, no especificada"},
        {c: "P52.9", d: "Hemorragia intracraneal no traumática del recién nacido"},
        {c: "P61.2", d: "Anemia de la prematurez"},
        {c: "P74.1", d: "Acidosis metabólica del recién nacido"}
    ];
    let listaDx = [];

    function motorCIE10(v) {
        const sug = document.getElementById('dx-sug');
        sug.innerHTML = '';
        if(v.length < 2) { sug.classList.add('hidden'); return; }
        const res = dbCIE.filter(i => i.d.toLowerCase().includes(v.toLowerCase()) || i.c.toLowerCase().includes(v.toLowerCase()));
        res.forEach(i => {
            const d = document.createElement('div');
            d.className = 'suggestion-item';
            d.innerText = i.c + " - " + i.d;
            d.onclick = () => { agregarDx(i); sug.classList.add('hidden'); };
            sug.appendChild(d);
        });
        sug.classList.remove('hidden');
    }

    function agregarDx(i) {
        listaDx.push(i);
        renderDxTable();
    }

    function renderDxTable() {
        const b = document.getElementById('bodyDx');
        b.innerHTML = '';
        listaDx.forEach((x, i) => {
            b.innerHTML += `<tr><td><b>${x.c}</b></td><td>${x.d}</td><td><button class="btn-del" onclick="listaDx.splice(${i},1);renderDxTable()">✖</button></td></tr>`;
        });
    }

    // 5. ADCAV (Motor de Cálculo Blindado)
    let medsPlan = [];
    function toggleAlim() {
        const t = document.getElementById('tipoA').value;
        document.getElementById('alimExtra').className = (t === 'NPO' ? 'hidden' : '');
        calcADCAVGlobal();
    }

    function agregarFilaMed() {
        medsPlan.push({n: 'AMPICILINA', d: 50, f: 12, c: 100});
        renderMedsTable();
    }

    function renderMedsTable() {
        const b = document.getElementById('bodyMeds');
        b.innerHTML = '';
        medsPlan.forEach((m, i) => {
            b.innerHTML += `
            <tr>
                <td><input type="text" value="${m.n}" oninput="medsPlan[${i}].n=this.value"></td>
                <td><input type="number" value="${m.d}" oninput="medsPlan[${i}].d=this.value; calcADCAVGlobal()"></td>
                <td><input type="number" value="${m.f}" oninput="medsPlan[${i}].f=this.value; calcADCAVGlobal()"></td>
                <td id="resM_${i}">0</td>
                <td><button class="btn-del" onclick="medsPlan.splice(${i},1);renderMedsTable()">✖</button></td>
            </tr>`;
        });
        calcADCAVGlobal();
    }

    function calcADCAVGlobal() {
        const peso = (parseFloat(document.getElementById('peso').value) || 3000) / 1000;
        const lt = parseFloat(document.getElementById('ltMeta').value) || 0;
        const dx = parseFloat(document.getElementById('dexP').value) || 10;
        
        let vAlim = 0;
        if(document.getElementById('tipoA').value !== 'NPO') {
            let ml = parseFloat(document.getElementById('mlA').value) || 0;
            let fr = parseFloat(document.getElementById('frA').value) || 3;
            vAlim = ml * (24/fr);
        }

        let vMeds = 0;
        medsPlan.forEach((m, i) => {
            let vol = ((m.d * peso) / m.c) * (24/m.f); // c=100 asume dilución estándar
            document.getElementById(`resM_${i}`).innerText = (vol/(24/m.f)).toFixed(2) + " ml/dosis";
            vMeds += vol;
        });

        const vTotal = lt * peso;
        const vIV = vTotal - vAlim - vMeds;
        const gtc = vIV / 24;
        const vig = (vIV * (dx/100)) / (1.44 * peso);

        document.getElementById('outLid').innerText = `TOTAL LÍQUIDOS IV: ${vIV.toFixed(1)} ml | GOTEO: ${gtc.toFixed(1)} ml/h | VIG: ${vig.toFixed(2)}`;
    }

    function actualizarPesoReferencia() { calcADCAVGlobal(); }

    /* =========================================================================
       BOTÓN FINAL: CONSOLIDACIÓN DE TODOS LOS DATOS
       ========================================================================= */
    function generarHistoriaClinicaFinal() {
        document.getElementById('exportArea').classList.remove('hidden');
        let t = "====================================================================\n";
        t += "        REGISTRO CLÍNICO NEONATAL INTEGRADO - HSVP\n";
        t += "====================================================================\n\n";
        
        t += "1. FILIACIÓN:\n";
        t += `PACIENTE: ${document.getElementById('ape1').value} ${document.getElementById('ape2').value} ${document.getElementById('nom').value}\n`;
        t += `HCU: ${document.getElementById('hcu').value} | SEXO: ${document.getElementById('sexo').value}\n`;
        t += `INGRESO: ${document.getElementById('fIngreso').value} | EDAD: ${document.getElementById('edadReal').value}\n`;
        t += `MADRE: ${document.getElementById('nomM').value} | EDAD: ${document.getElementById('edadM').value} | GS: ${document.getElementById('gsM').value}\n\n`;

        t += "2. ANTECEDENTES:\n";
        t += `EG FUM: ${document.getElementById('egFum').value} | G:${document.getElementById('gestas').value} P:${document.getElementById('partos').value}\n`;
        t += `PRENATALES: ${document.getElementById('antPre').value}\n`;
        t += `NATALES: ${document.getElementById('antNat').value}\n`;
        t += `POSTNATALES: ${document.getElementById('antPost').value}\n\n`;

        t += "3. EXAMEN FÍSICO Y ESCALAS:\n";
        t += `SIGNOS: FC:${document.getElementById('fc').value} FR:${document.getElementById('fr').value} T:${document.getElementById('temp').value} Sat:${document.getElementById('sat').value}\n`;
        t += `SOMATOMETRÍA: Peso:${document.getElementById('peso').value}g Talla:${document.getElementById('talla').value}cm PC:${document.getElementById('pCef').value}cm\n`;
        t += `ESCALAS: APGAR:${document.getElementById('ap1').value}/${document.getElementById('ap5').value} | SILVERMAN:${document.getElementById('silv').value} | CAPURRO:${document.getElementById('resCap').innerText}\n`;
        t += `HALLAZGOS: ${document.getElementById('ef_1').value}\n${document.getElementById('ef_3').value}\n${document.getElementById('ef_4').value}\n\n`;

        t += "4. DIAGNÓSTICOS (CIE-10):\n";
        listaDx.forEach(x => t += `- [${x.c}] ${x.d}\n`);
        t += "\n";

        t += "5. PLAN DE MANEJO (ADCAV):\n";
        t += `A: ${document.getElementById('tipoA').value} (${document.getElementById('mlA').value}ml c/${document.getElementById('frA').value}h)\n`;
        t += `D: ${document.getElementById('outLid').innerText}\n`;
        t += `C: ${document.getElementById('planC').value}\n`;
        t += `A: `; medsPlan.forEach(m => t += `${m.n}(${m.d}mg/kg), `); t += "\n";
        t += `V: ${document.getElementById('planV').value}\n\n`;

        t += "====================================================================\n";
        t += "GENERADO POR SISTEMA MASTER HSVP v2026\n";

        document.getElementById('textoFinal').innerText = t;
        window.scrollTo(0, document.body.scrollHeight);
    }

    // Inicialización automática
    window.onload = () => { agregarFilaMed(); };
</script>
</body>
</html>
